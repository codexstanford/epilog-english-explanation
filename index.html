<!-- adapted from MRG's insurance demo webpages and Epilog optimizer webpage -->
<html>
    <!--=======================================================================-->
    
    <head>
        <link rel="stylesheet" href="index.css">
        <script language='javascript' src='./src/epilog.js'></script>
        <script language='javascript' src='./src/explain.js'></script>
        
        <script language='javascript' src='./src/localstorage.js'></script>
        <script language='javascript' src='./src/language_utils.js'></script>
        <script language='javascript' src='./src/epilog_database.js'></script>    
        <script language='javascript' src='./src/english_explanation.js'></script>
        <script language='javascript'>
            const FACTS_FILE_SELECTOR_ID = "local_facts_file";
            const RULES_FILE_SELECTOR_ID = "local_rules_file";
            const METADATA_FILE_SELECTOR_ID = "local_metadata_file";
            const TEMPLATES_FILE_SELECTOR_ID = "local_english_templates_file";
            
            const defaultOptions = 
                                {typePredicate: "type", 
                                replaceWithType: true, 
                                removeClassAttributes: false,
                                bindLocalConstants: true,
                                verifyDerivable: true,
                                useMetadata: true,
                                linkFromExplanation: true,
                                linkGivenFacts: true};

            // Global to this file.
            let facts, rules, metadata, english_templates;
            
            function doinit () {
                let widget = document.getElementById('explanation');

                createEventListeners();

                // Set options if they haven't been initialized.
                setAllOptions(false, defaultOptions);

                // Don't load data unless this is the user's first visit to the page.
                loadEpilogAndTemplates(false).then(() => {
                    ({facts, rules, metadata, english_templates} = getEpilogAndTemplates());
                
                    const urlParameters = new URLSearchParams(window.location.search);

                    const options = getOptions(urlParameters);

                    setOptionCheckboxes(options);
                    updateUsingUploadedDataIndicator();

                    // No conclusion to explain
                    if (!urlParameters.has('conclusion') || urlParameters.get('conclusion') === "") {
                        widget.innerHTML = "<b>Explanation will be displayed here.</b>";
                        return;
                    }

                    const conclusion = urlParameters.get('conclusion');
                    
                    //Keep the conclusion text in the input textarea
                    document.getElementById('input_conclusion').innerHTML = conclusion;
                    widget.innerHTML = "<pre>" + toEnglish(conclusion, facts, rules, metadata, english_templates, options) + "</pre>";
                });
            }

            function getOptions(urlParameters) {
                // Get all options from localstorage
                let options = getAllOptions();

                console.log(options);

                // Override with options from url params.
                options.replaceWithType = getOptionFromParams("replaceWithType", urlParameters, options.replaceWithType);
                options.removeClassAttributes = getOptionFromParams("removeClassAttributes", urlParameters, options.removeClassAttributes);
                options.bindLocalConstants = getOptionFromParams("bindLocalConstants", urlParameters, options.bindLocalConstants);
                options.verifyDerivable = getOptionFromParams("verifyDerivable", urlParameters, options.verifyDerivable);
                options.linkFromExplanation = getOptionFromParams("linkFromExplanation", urlParameters, options.linkFromExplanation);
                options.linkGivenFacts = getOptionFromParams("linkGivenFacts", urlParameters, options.linkGivenFacts);

                // Update the options in localstorage
                setAllOptions(true, options);

                return options;
            }

            // Assumes this is a boolean option.
            function getOptionFromParams(optionName, urlParameters, defaultVal) {
                if (urlParameters.has(optionName)) {
                    return (urlParameters.get(optionName) === 'true');
                } 
                
                // If no url param for the option, return the default value.
                // localstorage only stores strings, so converting to boolean.
                return defaultVal === "true";
            }

            function setOptionCheckboxes(options) {
                console.log("setting removeclassattributes",options.removeClassAttributes);

                document.getElementById("replaceWithType").checked = options.replaceWithType;
                document.getElementById("removeClassAttributes").checked = options.removeClassAttributes;
                document.getElementById("bindLocalConstants").checked = options.bindLocalConstants;
                document.getElementById("verifyDerivable").checked = options.verifyDerivable;
                document.getElementById("linkFromExplanation").checked = options.linkFromExplanation;
                document.getElementById("linkGivenFacts").checked = options.linkGivenFacts;

                console.log("getting removeclassattributes",document.getElementById("removeClassAttributes").checked);
            }

            // Use whenever calling loadEpilogAndTemplates; defined and used here for MVC decomposition.
            function updateUsingUploadedDataIndicator() {
                let widget = document.getElementById("uploaded_data_use_indicator");
                if (localStorage[EPILOG_FACTS_KEY + UPLOADED_FILENAME_KEY_SUFFIX] !== "null" ||
                    localStorage[EPILOG_RULES_KEY + UPLOADED_FILENAME_KEY_SUFFIX] !== "null" || 
                    localStorage[EPILOG_METADATA_KEY + UPLOADED_FILENAME_KEY_SUFFIX] !== "null" ||
                    localStorage[ENGLISH_TEMPLATES_KEY + UPLOADED_FILENAME_KEY_SUFFIX] !== "null") {
                    
                    widget.style.display = "block";
                } else {
                    widget.style.display = "none";
                }
            }

            // Set up listeners for file change events
            function createEventListeners() {
                document.getElementById(FACTS_FILE_SELECTOR_ID).addEventListener("change", (event) => handleFileSelectedChange(event, FACTS_FILE_SELECTOR_ID));
                document.getElementById(RULES_FILE_SELECTOR_ID).addEventListener("change", (event) => handleFileSelectedChange(event, RULES_FILE_SELECTOR_ID));
                document.getElementById(METADATA_FILE_SELECTOR_ID).addEventListener("change", (event) => handleFileSelectedChange(event, METADATA_FILE_SELECTOR_ID));
                document.getElementById(TEMPLATES_FILE_SELECTOR_ID).addEventListener("change", (event) => handleFileSelectedChange(event, TEMPLATES_FILE_SELECTOR_ID));
            }

            //==============================================================================
            // Event handlers
            //==============================================================================
            
            function onClickGenerateExplanationHandler() {
                let widget = document.getElementById('input_conclusion');
                let newLocation = "./index.html?conclusion=" + widget.value;
                
                newLocation += "&replaceWithType=" + document.getElementById("replaceWithType").checked;
                newLocation += "&removeClassAttributes=" + document.getElementById("removeClassAttributes").checked;
                newLocation += "&bindLocalConstants=" + document.getElementById("bindLocalConstants").checked;
                newLocation += "&verifyDerivable=" + document.getElementById("verifyDerivable").checked;
                newLocation += "&linkFromExplanation=" + document.getElementById("linkFromExplanation").checked;
                newLocation += "&linkGivenFacts=" + document.getElementById("linkGivenFacts").checked;

                location = newLocation;
            }

            // Fill the conclusion input textarea with a random fact that matches a template.
                // Not a uniformly random fact; a template is chosen uniformly at random, then a fact is chosen uniformly at random from those that matched the template.
            function onClickGenerateExampleInputHandler() {
                let input_textarea = document.getElementById('input_conclusion');

                if (facts.length === 0) {
                    console.log("[Warning] No facts have been loaded.");
                    input_textarea.value = "Could not generate example: No facts have been loaded.";
                    return;
                }

                let english_templates_copy = [...english_templates];
                let randomFact = null;

                // Randomly pick templates until one can be found with matching facts.
                while (english_templates_copy.length > 0) {
                    let randomIndex = Math.floor(Math.random()*english_templates_copy.length);
                    let randomTemplate = english_templates_copy[randomIndex];

                    let queryGoal = randomTemplate.getQueryAsList()
                    
                    let randomMatchedFacts = compfinds(queryGoal, queryGoal, facts, rules);

                    // Found matching facts for the template
                    if (randomMatchedFacts.length > 0) {
                        randomFact = randomMatchedFacts[Math.floor(Math.random()*randomMatchedFacts.length)];
                        break;
                    }

                    // Did not find matching fact, so remove template from the list and try again.
                    english_templates_copy.splice(randomIndex, 1);
                }


                if (randomFact === null) {
                    console.log("[Warning] No fact could be found that matched a template. Selecting random fact.");
                    randomFact = facts[Math.floor(Math.random()*facts.length)];
                }
                        
                // Update the conclusion input textarea
                input_textarea.value = grind(randomFact);
            }
            
            function toggleReadonlyTextareaVisibility(textareaWidgetId) {
                let textareaWidget = document.getElementById(textareaWidgetId);
                let labelWidget = document.getElementById(textareaWidgetId + "_label")
                if (textareaWidget.style.display !== "none") {
                    textareaWidget.style.display = "none";
                    labelWidget.style.display = "none";
                    return;
                }

                textareaWidget.style.display = "block";
                labelWidget.style.display = "block";
            }

            function reloadDefaultEpilogAndTemplates() {
                setFactsFile(null);
                setRulesFile(null);
                setMetadataFile(null);
                setTemplatesFile(null);
        
                loadEpilogAndTemplates(true).then(() => {
                    updateUsingUploadedDataIndicator();
                });
            }

            function loadSelectedEpilogAndTemplates() {
                let factsFilesSelected = document.getElementById(FACTS_FILE_SELECTOR_ID).files;
                let rulesFilesSelected = document.getElementById(RULES_FILE_SELECTOR_ID).files;
                let metadataFilesSelected = document.getElementById(METADATA_FILE_SELECTOR_ID).files;
                let templatesFilesSelected = document.getElementById(TEMPLATES_FILE_SELECTOR_ID).files;

                // Currently, we use default data for those files that haven't been selected by the user.
                if (factsFilesSelected.length !== 0) {
                    setFactsFile(factsFilesSelected[0]);
                } else {
                    //setFactsFile(new File([""], ""));
                }

                if (rulesFilesSelected.length !== 0) {
                    setRulesFile(rulesFilesSelected[0]);
                } else {
                    //setRulesFile(new File([""], ""));
                }
                
                if (metadataFilesSelected.length !== 0) {
                    setMetadataFile(metadataFilesSelected[0]);
                } else {
                    //setMetadataFile(new File([""], ""));
                }

                if (templatesFilesSelected.length !== 0) {
                    setTemplatesFile(templatesFilesSelected[0]);
                } else {
                    //setTemplatesFile(new File([""], ""));
                }

                loadEpilogAndTemplates(true).then(() => {
                    updateUsingUploadedDataIndicator();
                });
            }

            function handleFileSelectedChange(event, fileSelectorWidgetId) {
                let filesSelected = document.getElementById(fileSelectorWidgetId).files;

                if (filesSelected.length === 0) {
                    console.log("[Warning] No file selected for", fileSelectorWidgetId)
                    return;
                }

                
                let selectedFileName = filesSelected[0].name;
                // Update the selected files
                switch (fileSelectorWidgetId) {
                    case FACTS_FILE_SELECTOR_ID:
                        document.getElementById("selected_facts_filename").innerHTML = selectedFileName;
                        break;
                    case RULES_FILE_SELECTOR_ID:
                        document.getElementById("selected_rules_filename").innerHTML = selectedFileName;
                        break;
                    case METADATA_FILE_SELECTOR_ID:
                        document.getElementById("selected_metadata_filename").innerHTML = selectedFileName;
                        break;
                    case TEMPLATES_FILE_SELECTOR_ID:
                        document.getElementById("selected_templates_filename").innerHTML = selectedFileName;
                        break;
                }

            }

        </script>
      
    </head>
    
    <!--=======================================================================-->

    <body onLoad='doinit()'>
        <div id='page_container'>
            <div id='title'>
                Epilog Explanation
            </div>
    
    <!--=======================================================================-->
    
      
    <hr class='horizontal_divider_explanation'/>
    <br/>
      
    
    
    <div id='explanation'>
    </div>

    
      
    <br/>
    <hr class='horizontal_divider_explanation'/>
    
    <div id = "button_container_explanation" class="button_container">
        <input type='button' value="Generate Explanation" onClick='onClickGenerateExplanationHandler();'/>
    </div>

    <div id = "option_container">
        <div>
            <input type="checkbox" id="replaceWithType" class="option_checkbox" name="replaceWithType" checked="true">
            <label for="replaceWithType" class="option_checkbox_label"> replaceWithType </label><br>
        </div>
        <div>
            <input type="checkbox" id="removeClassAttributes" class="option_checkbox" name="removeClassAttributes" checked="false">
            <label for="removeClassAttributes" class="option_checkbox_label"> removeClassAttributes </label><br>
        </div>
        <div>
            <input type="checkbox" id="bindLocalConstants" class="option_checkbox" name="bindLocalConstants" checked="true">
            <label for="bindLocalConstants" class="option_checkbox_label"> bindLocalConstants </label><br>
        </div>
        <div>
            <input type="checkbox" id="verifyDerivable" class="option_checkbox" name="verifyDerivable" checked="true">
            <label for="verifyDerivable" class="option_checkbox_label"> verifyDerivable </label><br>
        </div>
        <div>
            <input type="checkbox" id="linkFromExplanation" class="option_checkbox" name="linkFromExplanation" checked="true">
            <label for="linkFromExplanation" class="option_checkbox_label"> linkFromExplanation </label><br>
        </div>
        <div>
            <input type="checkbox" id="linkGivenFacts" class="option_checkbox" name="linkGivenFacts" checked="true">
            <label for="linkGivenFacts" class="option_checkbox_label"> linkGivenFacts </label><br>
        </div>
    </div>
    
    <textarea id='input_conclusion' class='input_textarea' rows='8' cols='80' wrap='soft' placeholder='Paste the Epilog ground atom you would like explained here.&#10&#10Click the button below for an example.'></textarea>

    <div id = "button_container_randomExample" class="button_container">
        <input type='button' value="Random Example" onClick='onClickGenerateExampleInputHandler();'/>
    </div>
    
    <hr class='horizontal_divider_fileUploading'/>

    <!--=======================================================================-->

    <div id = "button_container_data_loading" class="button_container">
        <input type='button' value="Reload Default Data" onClick='reloadDefaultEpilogAndTemplates();'/>
        <input type='button' value="Upload Chosen Custom Data" onClick='loadSelectedEpilogAndTemplates();'/>        
    </div>

    <div id="uploaded_data_use_indicator" style="display:block">Using uploaded data</div>


    <div id = "button_container_file_uploading" class="button_container">
        <div class="file_select_container">
            <label for="local_facts_file" class="file_upload_button_label">
                <input type="file" id="local_facts_file" name="local_facts_file" accept="text/*, .epilog" style="display:none">
                Choose Facts File
            </label>
            <div id="selected_facts_filename">No file chosen</div>
        </div>
        <div class="file_select_container">
            <label for="local_rules_file" class="file_upload_button_label">
                <input type="file" id="local_rules_file" name="local_rules_file" accept="text/*, .epilog" style="display:none">
                Choose Rules File
            </label>
            <div id="selected_rules_filename">No file chosen</div>
        </div>
        <div class="file_select_container">
            <label for="local_metadata_file" class="file_upload_button_label">
                <input type="file" id="local_metadata_file" name="local_metadata_file" accept="text/*, .epilog" style="display:none">
                Choose Metadata File
            </label>
            <div id="selected_metadata_filename">No file chosen</div>
        </div>
        <div class="file_select_container">
            <label for="local_english_templates_file" class="file_upload_button_label">
                <input type="file" id="local_english_templates_file" name="local_english_templates_file" accept="text/*, .epilog" style="display:none">
                Choose Templates File
            </label>
            <div id="selected_templates_filename">No file chosen</div>
        </div>
    </div>

    <div id = "button_container_visibility" class="button_container">
        <input type='button' value="Show/Hide Facts" onClick='toggleReadonlyTextareaVisibility("facts");'/>
        <input type='button' value="Show/Hide Rules" onClick='toggleReadonlyTextareaVisibility("rules");'/>
        <input type='button' value="Show/Hide Metadata" onClick='toggleReadonlyTextareaVisibility("metadata");'/>
        <input type='button' value="Show/Hide Templates" onClick='toggleReadonlyTextareaVisibility("english_templates");'/>
    </div>


    
    <p id='facts_label' class='readonly_textarea_label' style='display:none'>Default Facts</p>
    <textarea id='facts' class='readonly_textarea' readonly rows='12' cols='96' wrap='soft' style='display:none'>
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Background Data
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% person
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(alan_arrogant,person)
        person.firstname(alan_arrogant,"Alan")
        person.lastname(alan_arrogant,"Arrogant")
        person.gender(alan_arrogant,male)
        person.dob(alan_arrogant,1984_01_01)
        person.nationality(alan_arrogant,usa)
        person.countryofresidence(alan_arrogant,usa)
        person.occupation(alan_arrogant,educator)
        person.mobile(alan_arrogant,"555-1234")
        person.email(alan_arrogant,"arrogant@university.edu")
        person.image(alan_arrogant,"/insurance/images/alan.jpeg")

        type(bill_boring,person)
        person.firstname(bill_boring,"Bill")
        person.lastname(bill_boring,"Boring")
        person.gender(bill_boring,male)
        person.dob(bill_boring,1975_01_01)
        person.nationality(bill_boring,usa)
        person.countryofresidence(bill_boring,usa)
        person.occupation(bill_boring,educator)
        person.mobile(bill_boring,"555-2341")
        person.email(bill_boring,"boring@university.edu")
        person.image(bill_boring,"/insurance/images/bill.jpeg")

        type(cathy_careful,person)
        person.firstname(cathy_careful,"Cathy")
        person.lastname(cathy_careful,"Careful")
        person.gender(cathy_careful,female)
        person.dob(cathy_careful,1996_01_01)
        person.nationality(cathy_careful,usa)
        person.countryofresidence(cathy_careful,usa)
        person.occupation(cathy_careful,educator)
        person.mobile(cathy_careful,"555-3412")
        person.email(cathy_careful,"careful@university.edu")
        person.image(cathy_careful,"/insurance/images/cathy.jpeg")

        type(donna_daring,person)
        person.firstname(donna_daring,"Donna")
        person.lastname(donna_daring,"Daring")
        person.gender(donna_daring,female)
        person.dob(donna_daring,1987_01_01)
        person.nationality(donna_daring,usa)
        person.countryofresidence(donna_daring,usa)
        person.occupation(donna_daring,educator)
        person.mobile(donna_daring,"555-4123")
        person.email(donna_daring,"daring@university.edu")
        person.image(donna_daring,"/insurance/images/donna.jpeg")

        type(frank_frank,person)
        person.firstname(frank_frank,"Frank")
        person.lastname(frank_frank,"Frank")
        person.gender(frank_frank,male)
        person.dob(frank_frank,1963_10_01)
        person.nationality(frank_frank,usa)
        person.countryofresidence(frank_frank,usa)
        person.occupation(frank_frank,educator)
        person.mobile(frank_frank,"555-1235")
        person.email(frank_frank,"frank@university.edu")
        person.image(frank_frank,"/insurance/images/frank.jpeg")

        type(gary_grump,person)
        person.firstname(gary_grump,"Gary")
        person.lastname(gary_grump,"Grump")
        person.gender(gary_grump,male)
        person.dob(gary_grump,1956_01_01)
        person.nationality(gary_grump,usa)
        person.countryofresidence(gary_grump,usa)
        person.occupation(gary_grump,educator)
        person.mobile(gary_grump,"555-2351")
        person.email(gary_grump,"grump@university.edu")
        person.image(gary_grump,"/insurance/images/gary.jpeg")

        type(helen_heavenly,person)
        person.firstname(helen_heavenly,"Helen")
        person.lastname(helen_heavenly,"Heavenly")
        person.gender(helen_heavenly,female)
        person.dob(helen_heavenly,1986_01_01)
        person.nationality(helen_heavenly,usa)
        person.countryofresidence(helen_heavenly,usa)
        person.occupation(helen_heavenly,educator)
        person.mobile(helen_heavenly,"555-3512")
        person.email(helen_heavenly,"heavenly@university.edu")
        person.image(helen_heavenly,"/insurance/images/helen.jpeg")

        type(ivan_illegible,person)
        person.firstname(ivan_illegible,"Ivan")
        person.lastname(ivan_illegible,"Illegible")
        person.gender(ivan_illegible,male)
        person.dob(ivan_illegible,1982_01_01)
        person.nationality(ivan_illegible,usa)
        person.countryofresidence(ivan_illegible,usa)
        person.occupation(ivan_illegible,educator)
        person.mobile(ivan_illegible,"555-5123")
        person.email(ivan_illegible,"illegible@university.edu")
        person.image(ivan_illegible,"/insurance/images/ivan.jpeg")

        type(oren_overbearing,person)
        person.firstname(oren_overbearing,"Oren")
        person.lastname(oren_overbearing,"Overbearing")
        person.gender(oren_overbearing,male)
        person.dob(oren_overbearing,1984_01_01)
        person.nationality(oren_overbearing,usa)
        person.countryofresidence(oren_overbearing,usa)
        person.occupation(oren_overbearing,educator)
        person.mobile(oren_overbearing,"555-1236")
        person.email(oren_overbearing,"overbearing@university.edu")
        person.image(oren_overbearing,"/insurance/images/oren.jpeg")

        type(paul_pompous,person)
        person.firstname(paul_pompous,"Paul")
        person.lastname(paul_pompous,"Pompous")
        person.gender(paul_pompous,male)
        person.dob(paul_pompous,1992_01_01)
        person.nationality(paul_pompous,usa)
        person.countryofresidence(paul_pompous,usa)
        person.occupation(paul_pompous,educator)
        person.mobile(paul_pompous,"555-3612")
        person.email(paul_pompous,"pompous@university.edu")
        person.image(paul_pompous,"/insurance/images/paul.jpeg")

        type(polly_syllabic,person)
        person.firstname(polly_syllabic,"Polly")
        person.lastname(polly_syllabic,"Syllabic")
        person.gender(polly_syllabic,female)
        person.dob(polly_syllabic,1986_01_01)
        person.nationality(polly_syllabic,usa)
        person.countryofresidence(polly_syllabic,usa)
        person.occupation(polly_syllabic,educator)
        person.mobile(polly_syllabic,"555-2361")
        person.email(polly_syllabic,"syllabic@university.edu")
        person.image(polly_syllabic,"/insurance/images/polly.jpeg")

        type(tanya_terrible,person)
        person.firstname(tanya_terrible,"Tanya")
        person.lastname(tanya_terrible,"Terrible")
        person.gender(tanya_terrible,female)
        person.dob(tanya_terrible,1997_01_01)
        person.nationality(tanya_terrible,usa)
        person.countryofresidence(tanya_terrible,usa)
        person.occupation(tanya_terrible,educator)
        person.mobile(tanya_terrible,"555-6123")
        person.email(tanya_terrible,"terrible@university.edu")
        person.image(tanya_terrible,"/insurance/images/tanya.jpeg")


        type(aaron_aardvark,person)
        person.firstname(aaron_aardvark,"Aaron")
        person.lastname(aaron_aardvark,"Aardvark")
        person.gender(aaron_aardvark,male)
        person.dob(aaron_aardvark,1974_03_17)
        person.nationality(aaron_aardvark,usa)
        person.occupation(aaron_aardvark,student)
        person.mobile(aaron_aardvark,"555-4657")
        person.email(aaron_aardvark,"ants@university.edu")
        person.image(aaron_aardvark,"/insurance/images/aaron.jpeg")

        type(belinda_bat,person)
        person.firstname(belinda_bat,"Belinda")
        person.lastname(belinda_bat,"Bat")
        person.gender(belinda_bat,female)
        person.dob(belinda_bat,1986_03_17)
        person.nationality(belinda_bat,usa)
        person.occupation(belinda_bat,student)
        person.mobile(belinda_bat,"555-4657")
        person.email(belinda_bat,"sonar@university.edu")
        person.image(belinda_bat,"/insurance/images/belinda.jpeg")

        type(calvin_carp,person)
        person.firstname(calvin_carp,"Calvin")
        person.lastname(calvin_carp,"Carp")
        person.gender(calvin_carp,male)
        person.dob(calvin_carp,1973_10_15)
        person.nationality(calvin_carp,usa)
        person.occupation(calvin_carp,student)
        person.mobile(calvin_carp,"555-4657")
        person.email(calvin_carp,"scales@university.edu")
        person.image(calvin_carp,"/insurance/images/calvin.jpeg")

        type(george_giraffe,person)
        person.firstname(george_giraffe,"George")
        person.lastname(george_giraffe,"Giraffe")
        person.gender(george_giraffe,male)
        person.dob(george_giraffe,2003_10_15)
        person.nationality(george_giraffe,usa)
        person.occupation(george_giraffe,student)
        person.mobile(george_giraffe,"555-4657")
        person.email(george_giraffe,"neck@university.edu")
        person.image(george_giraffe,"/insurance/images/george.jpeg")

        type(kitty_kat,person)
        person.firstname(kitty_kat,"Kitty")
        person.lastname(kitty_kat,"Kat")
        person.gender(kitty_kat,female)
        person.dob(kitty_kat,2003_10_15)
        person.nationality(kitty_kat,usa)
        person.countryofresidence(kitty_kat,usa)
        person.occupation(kitty_kat,student)
        person.occupation(tanya_terrible,student)
        person.mobile(kitty_kat,"555-4657")
        person.email(kitty_kat,"catnip@university.edu")
        person.image(kitty_kat,"/insurance/images/kitty.jpeg")

        type(minnie_mouse,person)
        person.firstname(minnie_mouse,"Minnie")
        person.lastname(minnie_mouse,"Mouse")
        person.gender(minnie_mouse,female)
        person.dob(minnie_mouse,2003_10_15)
        person.nationality(minnie_mouse,usa)
        person.occupation(minnie_mouse,student)
        person.mobile(minnie_mouse,"555-4657")
        person.email(minnie_mouse,"cheese@university.edu")
        person.image(minnie_mouse,"/insurance/images/minnie.jpeg")

        type(patty_panda,person)
        person.firstname(patty_panda,"Patty")
        person.lastname(patty_panda,"Panda")
        person.gender(patty_panda,female)
        person.dob(patty_panda,2003_10_15)
        person.nationality(patty_panda,usa)
        person.occupation(patty_panda,student)
        person.mobile(patty_panda,"555-4657")
        person.email(patty_panda,"bear@university.edu")
        person.image(patty_panda,"/insurance/images/patty.jpeg")

        type(rory_rhino,person)
        person.firstname(rory_rhino,"Rory")
        person.lastname(rory_rhino,"Rhino")
        person.gender(rory_rhino,male)
        person.dob(rory_rhino,2003_10_15)
        person.nationality(rory_rhino,usa)
        person.occupation(rory_rhino,student)
        person.mobile(rory_rhino,"555-4327")
        person.email(rory_rhino,"horn@university.edu")
        person.image(rory_rhino,"/insurance/images/rory.jpeg")

        type(sally_squirrel,person)
        person.firstname(sally_squirrel,"Sally")
        person.lastname(sally_squirrel,"Squirrel")
        person.gender(sally_squirrel,female)
        person.dob(sally_squirrel,2003_10_15)
        person.nationality(sally_squirrel,usa)
        person.occupation(sally_squirrel,student)
        person.mobile(sally_squirrel,"555-4327")
        person.email(sally_squirrel,"nuts@university.edu")
        person.image(sally_squirrel,"/insurance/images/sally.jpeg")

        type(steve_squirrel,person)
        person.firstname(steve_squirrel,"Steve")
        person.lastname(steve_squirrel,"Squirrel")
        person.gender(steve_squirrel,male)
        person.dob(steve_squirrel,2073_10_15)
        person.nationality(steve_squirrel,usa)
        person.occupation(steve_squirrel,exterminator)
        person.mobile(steve_squirrel,"555-4327")
        person.email(steve_squirrel,"steve@squirrels.com")

        type(susan_squirrel,person)
        person.firstname(susan_squirrel,"Susan")
        person.lastname(susan_squirrel,"Squirrel")
        person.gender(susan_squirrel,female)
        person.dob(susan_squirrel,2078_10_15)
        person.nationality(susan_squirrel,usa)
        person.occupation(susan_squirrel,housewife)
        person.mobile(susan_squirrel,"555-4327")
        person.email(susan_squirrel,"susan@squirrels.com")

        type(tony_tuna,person)
        person.firstname(tony_tuna,"Tony")
        person.lastname(tony_tuna,"Tuna")
        person.gender(tony_tuna,male)
        person.dob(tony_tuna,2003_10_15)
        person.nationality(tony_tuna,usa)
        person.occupation(tony_tuna,student)
        person.mobile(tony_tuna,"555-4327")
        person.email(tony_tuna,"starkist@university.edu")
        person.image(tony_tuna,"/insurance/images/tony.jpeg")

        type(wanda_wolf,person)
        person.firstname(wanda_wolf,"Wanda")
        person.lastname(wanda_wolf,"Wolf")
        person.gender(wanda_wolf,female)
        person.dob(wanda_wolf,2003_10_15)
        person.nationality(wanda_wolf,usa)
        person.occupation(wanda_wolf,student)
        person.mobile(wanda_wolf,"555-4327")
        person.email(wanda_wolf,"howl@university.edu")
        person.image(wanda_wolf,"/insurance/images/wanda.jpeg")

        type(zack_zebra,person)
        person.firstname(zack_zebra,"Zack")
        person.lastname(zack_zebra,"Zebra")
        person.gender(zack_zebra,male)
        person.dob(zack_zebra,2003_10_15)
        person.nationality(zack_zebra,usa)
        person.occupation(zack_zebra,student)
        person.mobile(zack_zebra,"555-4567")
        person.email(zack_zebra,"stripes@university.edu")
        person.image(zack_zebra,"/insurance/images/zack.jpeg")

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% hospital
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(american_hospital,hospital)
        hospital.name(american_hospital,"American Hospital of Paris")
        hospital.country(american_hospital,france)

        type(bangkok_hospital,hospital)
        hospital.name(bangkok_hospital,"Bangkok Hospital")
        hospital.country(bangkok_hospital,thailand)

        type(hospital_angeles,hospital)
        hospital.name(hospital_angeles,"Hospital Angeles Mexico")
        hospital.country(hospital_angeles,mexico)

        type(hospital_de_barcelona,hospital)
        hospital.name(hospital_de_barcelona,"Hospital de Barcelona")
        hospital.country(hospital_de_barcelona,spain)

        type(hospital_samaritano,hospital)
        hospital.name(hospital_samaritano,"Hospital Samaritano")
        hospital.country(hospital_samaritano,brazil)

        type(johns_hopkins,hospital)
        hospital.name(johns_hopkins,"Johns Hopkins Medical Center")
        hospital.country(johns_hopkins,usa)

        type(martin_luther,hospital)
        hospital.name(martin_luther,"Martin Luther")
        hospital.country(martin_luther,germany)

        type(stanford_hospital,hospital)
        hospital.name(stanford_hospital,"Stanford Hospital")
        hospital.country(stanford_hospital,usa)

        type(mass_general,hospital)
        hospital.name(mass_general,"Massachusetts General Hospital")
        hospital.country(mass_general,usa)

        type(royal_london,hospital)
        hospital.name(royal_london,"Royal London Hospital")
        hospital.country(royal_london,uk)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% country
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(afghanistan,country)
        country.continent(afghanistan,asia)

        type(albania,country)
        country.continent(albania,europe)

        type(algeria,country)
        country.continent(algeria,africa)

        type(andorra,country)
        country.name(andorra,"Andorra")
        country.continent(andorra,europe)

        type(angola,country)
        country.continent(angola,africa)

        type(antigua,country)
        country.continent(antigua,north_america)

        type(argentina,country)
        country.continent(argentina,south_america)

        type(armenia,country)
        country.continent(armenia,asia)

        type(australia,country)
        country.name(australia,"Australia")
        country.continent(australia,oceania)

        type(austria,country)
        country.continent(austria,europe)

        type(azerbaijan,country)
        type(bahamas,country)
        type(bahrain,country)
        type(bangladesh,country)
        type(barbados,country)
        type(belgium,country)
        type(belize,country)
        type(belorussia,country)
        type(benin,country)
        type(bhutan,country)
        type(bolivia,country)
        type(bosnia_herzegovina,country)
        type(botswana,country)
        type(brazil,country)
        type(brunei,country)
        type(bulgaria,country)
        type(burkina,country)
        type(burma,country)
        type(burundi,country)
        type(cambodia,country)
        type(cameroon,country)

        type(canada,country)
        country.name(canada,"Canada")
        country.continent(canada,north_america)

        type(cape_verde,country)
        type(central_africa,country)
        type(chad,country)

        type(chile,country)
        country.name(chile,"Chile")
        country.continent(chile,south_america)

        type(china,country)
        type(colombia,country)
        type(comoros,country)
        type(congo,country)
        type(costa_rica,country)
        type(croatia,country)
        type(cuba,country)
        type(cyprus,country)
        type(czech_republic,country)
        type(denmark,country)
        type(djibouti,country)
        type(dominica,country)
        type(dominican_republic,country)
        type(ecuador,country)
        type(egypt,country)
        type(el_salvador,country)
        type(equatorial_guinea,country)
        type(eritrea,country)
        type(estonia,country)
        type(ethiopia,country)
        type(fiji,country)
        type(finland,country)

        type(france,country)
        country.name(france,"France")
        country.continent(france,europe)

        type(gabon,country)
        type(gambia,country)
        type(germany,country)
        type(ghana,country)
        type(greece,country)
        type(grenada,country)
        type(guatemala,country)
        type(guinea,country)
        type(guinea_bissau,country)
        type(guyana,country)
        type(haiti,country)
        type(honduras,country)
        type(hungary,country)
        type(iceland,country)
        type(india,country)
        type(indonesia,country)
        type(iran,country)
        type(irag,country)
        type(ireland,country)
        type(israel,country)
        type(italy,country)
        type(ivory_coast,country)
        type(jamaica,country)

        type(japan,country)
        country.name(japan,"Japan")
        country.continent(japan,asia)

        type(jordan,country)
        type(kazakhstan,country)
        type(kenya,country)
        type(kiribati,country)
        type(kuwait,country)
        type(kyrgyzstan,country)
        type(laos,country)
        type(latvia,country)
        type(lebanon,country)
        type(lesotho,country)
        type(liberia,country)
        type(libya,country)
        type(liechtenstein,country)
        type(lithuania,country)
        type(luxembourg,country)
        type(macedonia,country)
        type(madagascar,country)
        type(malawi,country)
        type(malaysia,country)
        type(maldives,country)
        type(mali,country)
        type(malta,country)
        type(marshall_islands,country)
        type(mauritania,country)
        type(mauritius,country)

        type(mexico,country)
        country.name(mexico,"Mexico")
        country.continent(mexico,north_america)

        type(micronesia,country)
        type(moldova,country)
        type(mongolia,country)
        type(morocco,country)
        type(mozambique,country)
        type(namibia,country)
        type(nepal,country)
        type(netherlands,country)
        type(new_zealand,country)
        type(nicaragua,country)
        type(niger,country)
        type(nigeria,country)
        type(north_korea,country)
        type(norway,country)
        type(oman,country)
        type(pakistan,country)
        type(panama,country)
        type(papua_new_guinea,country)
        type(paraguay,country)
        type(peru,country)
        type(phillipines,country)
        type(poland,country)
        type(portugal,country)
        type(romania,country)
        type(russian_federation,country)
        type(rwanda,country)
        type(saint_kitts,country)
        type(saint_lucia,country)
        type(saint_vincent,country)
        type(san_marino,country)
        type(sao_tome,country)
        type(saudi_arabia,country)
        type(senegal,country)
        type(seychelles,country)
        type(sierra_leone,country)
        type(singapore,country)
        type(slovakia,country)
        type(slovenia,country)
        type(solomon_islands,country)
        type(somalia,country)
        type(south_africa,country)
        type(south_korea,country)

        type(spain,country)
        country.name(spain,"Spain")
        country.continent(spain,europe)

        type(sri_lanka,country)
        type(sudan,country)
        type(surinam,country)
        type(swaziland,country)
        type(sweden,country)
        type(switzerland,country)
        type(syria,country)
        type(taiwan,country)
        type(tajikistan,country)
        type(tanzania,country)
        type(thailand,country)
        type(togo,country)
        type(trindad,country)
        type(tunisia,country)
        type(turkey,country)
        type(turkmenistan,country)
        type(uganda,country)

        type(uk,country)
        country.name(uk,"United Kingdom")
        country.continent(uk,europe)

        type(ukraine,country)
        type(uae,country)

        type(usa,country)
        country.name(usa,"United States")
        country.continent(usa,north_america)

        type(uruguay,country)
        type(uzbekistan,country)
        type(vanuatu,country)
        type(venezuela,country)
        type(vietnam,country)
        type(western_samoa,country)
        type(yemen,country)
        type(yugoslavia,country)
        type(zaire,country)
        type(zambia,country)

        type(zimbabwe,country)
        country.name(zimbabwe,"Zimbabwe")
        country.continent(zimbabwe,africa)

        country.continent(azerbaijan,asia)
        country.continent(bahamas,north_america)
        country.continent(bahrain,asia)
        country.continent(bangladesh,asia)
        country.continent(barbados,north_america)
        country.continent(belgium,europe)
        country.continent(belize,north_america)
        country.continent(belorussia,europe)
        country.continent(benin,africa)
        country.continent(bhutan,asia)
        country.continent(bolivia,south_america)
        country.continent(bosnia_herzegovina,europe)
        country.continent(botswana,africa)
        country.continent(brazil,south_america)
        country.continent(brunei,asia)
        country.continent(bulgaria,europe)
        country.continent(burkina,africa)
        country.continent(burma,asia)
        country.continent(burundi,africa)
        country.continent(cambodia,asia)
        country.continent(cameroon,africa)
        country.continent(cape_verde,africa)
        country.continent(central_africa,africa)
        country.continent(chad,africa)
        country.continent(china,asia)
        country.continent(colombia,south_america)
        country.continent(comoros,africa)
        country.continent(congo,africa)
        country.continent(costa_rica,north_america)
        country.continent(croatia,europe)
        country.continent(cuba,north_america)
        country.continent(cyprus,europe)
        country.continent(czech_republic,europe)
        country.continent(denmark,europe)
        country.continent(djibouti,africa)
        country.continent(dominica,north_america)
        country.continent(dominican_republic,north_america)
        country.continent(ecuador,south_america)
        country.continent(egypt,africa)
        country.continent(el_salvador,north_america)
        country.continent(equatorial_guinea,africa)
        country.continent(eritrea,africa)
        country.continent(estonia,europe)
        country.continent(ethiopia,africa)
        country.continent(fiji,oceania)
        country.continent(finland,europe)
        country.continent(gabon,africa)
        country.continent(gambia,africa)
        country.continent(germany,europe)
        country.continent(ghana,africa)
        country.continent(greece,europe)
        country.continent(grenada,north_america)
        country.continent(guatemala,north_america)
        country.continent(guinea,africa)
        country.continent(guinea_bissau,africa)
        country.continent(guyana,south_america)
        country.continent(haiti,north_america)
        country.continent(honduras,north_america)
        country.continent(hungary,europe)
        country.continent(iceland,europe)
        country.continent(india,asia)
        country.continent(indonesia,asia)
        country.continent(iran,asia)
        country.continent(irag,asia)
        country.continent(ireland,europe)
        country.continent(israel,asia)
        country.continent(italy,europe)
        country.continent(ivory_coast,africa)
        country.continent(jamaica,north_america)
        country.continent(jordan,asia)
        country.continent(kazakhstan,asia)
        country.continent(kenya,africa)
        country.continent(kiribati,oceania)
        country.continent(kuwait,asia)
        country.continent(kyrgyzstan,asia)
        country.continent(laos,asia)
        country.continent(latvia,europe)
        country.continent(lebanon,asia)
        country.continent(lesotho,africa)
        country.continent(liberia,africa)
        country.continent(libya,africa)
        country.continent(liechtenstein,europe)
        country.continent(lithuania,europe)
        country.continent(luxembourg,europe)
        country.continent(macedonia,europe)
        country.continent(madagascar,africa)
        country.continent(malawi,africa)
        country.continent(malaysia,asia)
        country.continent(maldives,asia)
        country.continent(mali,africa)
        country.continent(malta,europe)
        country.continent(marshall_islands,oceania)
        country.continent(mauritania,africa)
        country.continent(mauritius,africa)
        country.continent(micronesia,oceania)
        country.continent(moldova,europe)
        country.continent(mongolia,asia)
        country.continent(morocco,africa)
        country.continent(mozambique,africa)
        country.continent(namibia,africa)
        country.continent(nepal,asia)
        country.continent(netherlands,europe)
        country.continent(new_zealand,oceania)
        country.continent(nicaragua,north_america)
        country.continent(niger,africa)
        country.continent(nigeria,africa)
        country.continent(north_korea,asia)
        country.continent(norway,europe)
        country.continent(oman,asia)
        country.continent(pakistan,asia)
        country.continent(panama,north_america)
        country.continent(papua_new_guinea,oceania)
        country.continent(paraguay,south_america)
        country.continent(peru,south_america)
        country.continent(phillipines,asia)
        country.continent(poland,europe)
        country.continent(portugal,europe)
        country.continent(romania,europe)
        country.continent(russian_federation,asia)
        country.continent(rwanda,africa)
        country.continent(saint_kitts,north_america)
        country.continent(saint_lucia,north_america)
        country.continent(saint_vincent,north_america)
        country.continent(san_marino,europe)
        country.continent(sao_tome,africa)
        country.continent(saudi_arabia,asia)
        country.continent(senegal,africa)
        country.continent(seychelles,africa)
        country.continent(sierra_leone,africa)
        country.continent(singapore,asia)
        country.continent(slovakia,europe)
        country.continent(slovenia,europe)
        country.continent(solomon_islands,oceania)
        country.continent(somalia,africa)
        country.continent(south_africa,africa)
        country.continent(south_korea,asia)
        country.continent(sri_lanka,asia)
        country.continent(sudan,africa)
        country.continent(surinam,south_america)
        country.continent(swaziland,africa)
        country.continent(sweden,europe)
        country.continent(switzerland,europe)
        country.continent(syria,asia)
        country.continent(taiwan,asia)
        country.continent(tajikistan,asia)
        country.continent(tanzania,africa)
        country.continent(thailand,asia)
        country.continent(togo,africa)
        country.continent(trindad,north_america)
        country.continent(tunisia,africa)
        country.continent(turkey,europe)
        country.continent(turkmenistan,europe)
        country.continent(uganda,africa)
        country.continent(ukraine,europe)
        country.continent(uae,asia)
        country.continent(uruguay,south_america)
        country.continent(uzbekistan,asia)
        country.continent(vanuatu,asia)
        country.continent(venezuela,south_america)
        country.continent(vietnam,asia)
        country.continent(western_samoa,asia)
        country.continent(yemen,asia)
        country.continent(yugoslavia,europe)
        country.continent(zaire,africa)
        country.continent(zambia,africa)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% boolean
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(true,boolean)
        type(false,boolean)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% continent
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(africa,continent)
        type(antarctica,continent)
        type(asia,continent)
        type(europe,continent)
        type(north_america,continent)
        type(south_america,continent)
        type(oceania,continent)

        adjacent_continent(africa,europe)
        adjacent_continent(europe,africa)
        adjacent_continent(europe,asia)
        adjacent_continent(asia,europe)
        adjacent_continent(asia,africa)
        adjacent_continent(africa,asia)
        adjacent_continent(north_america,south_america)
        adjacent_continent(south_america,north_america)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% date
        %%% YYYY_MM_DD
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% gender
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(female,boolean)
        type(male,boolean)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% number
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% profession
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(artist,profession)
        type(educator,profession)
        type(musician,profession)
        type(student,profession)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% string
        %%% enclosed in quotes
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% time
        %%% HH_MM_SS
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% activities
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(archery,event)
        type(badminton,event)
        type(bicycling,event)
        type(dancing,event)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% events
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(earthquake,event)
        type(tornado,event)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% diagnoses
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(asthma,diagnosis)
        type(back_pain,diagnosis)
        type(broken_arm,diagnosis)
        type(broken_leg,diagnosis)
        type(kidney_stones,diagnosis)
        type(sprained_ankle,diagnosis)
        type(ulcer,diagnosis)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Insurance Data
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% policy
        %%% endorsements forthcoming
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(policy1,policy)
        policy.insuree(policy1,alan_arrogant)
        policy.type(policy1,"Hospital Cash")
        policy.startdate(policy1,2018_01_01)
        policy.enddate(policy1,2018_12_31)

        type(policy2,policy)
        policy.insuree(policy2,bill_boring)
        policy.type(policy2,"Hospital Cash")
        policy.startdate(policy2,2018_01_01)
        policy.enddate(policy2,2018_12_31)

        type(policy3,policy)
        policy.insuree(policy3,cathy_careful)
        policy.type(policy3,"Hospital Cash")
        policy.startdate(policy3,2018_01_01)
        policy.enddate(policy3,2018_12_31)

        type(policy4,policy)
        policy.insuree(policy4,donna_daring)
        policy.type(policy4,"Hospital Cash")
        policy.startdate(policy4,2020_01_01)
        policy.enddate(policy4,2020_12_31)

        type(policy5,policy)
        policy.insuree(policy5,frank_frank)
        policy.type(policy5,"Hospital Cash")
        policy.startdate(policy5,2019_01_01)
        policy.enddate(policy5,2019_12_31)

        type(policy6,policy)
        policy.insuree(policy6,gary_grump)
        policy.type(policy6,"Hospital Cash")
        policy.startdate(policy6,2017_01_01)
        policy.enddate(policy6,2017_12_31)

        type(policy7,policy)
        policy.insuree(policy7,helen_heavenly)
        policy.type(policy7,"Hospital Cash")
        policy.startdate(policy7,2020_01_01)
        policy.enddate(policy7,2020_12_31)

        type(policy8,policy)
        policy.insuree(policy8,ivan_illegible)
        policy.type(policy8,"Hospital Cash")
        policy.startdate(policy8,2017_01_01)
        policy.enddate(policy8,2017_12_31)

        type(policy9,policy)
        policy.insuree(policy9,oren_overbearing)
        policy.type(policy9,"Hospital Cash")
        policy.startdate(policy9,2020_01_01)
        policy.enddate(policy9,2020_12_31)

        type(policy10,policy)
        policy.insuree(policy10,paul_pompous)
        policy.type(policy10,"Hospital Cash")
        policy.startdate(policy10,2017_01_01)
        policy.enddate(policy10,2017_12_31)

        type(policy11,policy)
        policy.insuree(policy11,polly_syllabic)
        policy.type(policy11,"Hospital Cash")
        policy.startdate(policy11,2019_01_01)
        policy.enddate(policy11,2019_12_31)

        type(policy12,policy)
        policy.insuree(policy12,tanya_terrible)
        policy.type(policy212,"Hospital Cash")
        policy.startdate(policy12,2019_01_01)
        policy.enddate(policy12,2019_12_31)

        type(policy13,policy)
        policy.insuree(policy13,aaron_aardvark)
        policy.type(policy13,"Hospital Cash")
        policy.startdate(policy13,2019_01_01)
        policy.enddate(policy13,2019_12_31)

        type(policy14,policy)
        policy.insuree(policy14,belinda_bat)
        policy.type(policy14,"Hospital Cash")
        policy.startdate(policy14,2020_01_01)
        policy.enddate(policy14,2020_12_31)

        type(policy15,policy)
        policy.insuree(policy15,calcin_carp)
        policy.type(policy15,"Hospital Cash")
        policy.startdate(policy15,2019_01_01)
        policy.enddate(policy15,2019_12_31)

        type(policy21,policy)
        policy.insuree(policy21,steve_squirrel)
        policy.dependent(policy21,sally_squirrel)
        policy.dependent(policy21,susan_squirrel)
        policy.type(policy21,"Hospital Cash")
        policy.startdate(policy21,2021_01_01)
        policy.enddate(policy21,2021_12_31)

        type(policy22,policy)
        policy.insuree(policy22,steve_squirrel)
        policy.dependent(policy22,sally_squirrel)
        policy.dependent(policy22,susan_squirrel)
        policy.type(policy22,"Surgery Benefit")
        policy.startdate(policy22,2021_01_01)
        policy.enddate(policy22,2021_12_31)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% claim
        %%% claimlines forthcoming
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(claim1,claim)
        claim.date(claim1,2018_11_03)
        claim.policy(claim1,policy1)
        claim.hospitalization(claim1,hospitalization51)
        claim.exclusion(claim1,preexist)
        claim.disposition(claim1,declined)
        claim.justification(claim1,"Pre-existing condition.")

        type(claim2,claim)
        claim.date(claim2,2019_12_31)
        claim.policy(claim2,policy2)
        claim.hospitalization(claim2,hospitalization52)
        claim.disposition(claim2,declined)
        claim.justification(claim2,"Confinement did not last for at least 24 hours.")

        type(claim3,claim)
        claim.date(claim3,2019_12_31)
        claim.policy(claim3,policy3)
        claim.hospitalization(claim3,hospitalization53)
        claim.disposition(claim3,declined)
        claim.justification(claim3,"Confinement did not last for at least 24 hours.")
        claim.justification(claim3,"Not qualified hospital.")

        type(claim4,claim)
        claim.date(claim4,2021_09_31)
        claim.policy(claim4,policy4)
        claim.hospitalization(claim4,hospitalization54)
        claim.exclusion(claim1,preexist)
        claim.disposition(claim4,declined)
        claim.justification(claim4,"Pre-existing condition.")

        type(claim5,claim)
        claim.date(claim5,2019_12_31)
        claim.policy(claim5,policy5)
        claim.hospitalization(claim5,hospitalization55)
        claim.disposition(claim5,declined)
        claim.justification(claim5,"Confinement did not last for at least 24 hours.")

        type(claim6,claim)
        claim.date(claim6,2017_12_31)
        claim.policy(claim6,policy6)
        claim.hospitalization(claim6,hospitalization56)
        claim.disposition(claim6,paid)

        type(claim7,claim)
        claim.date(claim7,2020_12_31)
        claim.policy(claim7,policy7)
        claim.hospitalization(claim7,hospitalization57)
        claim.disposition(claim7,paid)

        type(claim8,claim)
        claim.date(claim8,2017_12_31)
        claim.policy(claim8,policy8)
        claim.hospitalization(claim8,hospitalization58)
        claim.disposition(claim8,paid)

        type(claim9,claim)
        claim.date(claim9,2020_12_31)
        claim.policy(claim9,policy9)
        claim.hospitalization(claim9,hospitalization59)
        claim.disposition(claim9,paid)

        type(claim10,claim)
        claim.date(claim10,2017_12_31)
        claim.policy(claim10,policy10)
        claim.hospitalization(claim10,hospitalization60)
        claim.disposition(claim10,paid)

        type(claim11,claim)
        claim.date(claim11,2019_12_31)
        claim.policy(claim11,policy11)
        claim.hospitalization(claim11,hospitalization61)
        claim.disposition(claim11,paid)

        type(claim12,claim)
        claim.date(claim12,2019_12_31)
        claim.policy(claim12,policy12)
        claim.hospitalization(claim12,hospitalization62)
        claim.disposition(claim12,paid)

        type(claim13,claim)
        claim.date(claim13,2019_12_31)
        claim.policy(claim13,policy13)
        claim.hospitalization(claim13,hospitalization63)
        claim.disposition(claim13,paid)

        type(claim14,claim)
        claim.date(claim14,2020_12_31)
        claim.policy(claim14,policy14)
        claim.hospitalization(claim14,hospitalization64)
        claim.disposition(claim14,paid)

        type(claim15,claim)
        claim.date(claim15,2019_12_31)
        claim.policy(claim15,policy15)
        claim.hospitalization(claim15,hospitalization65)
        claim.disposition(claim15,paid)


        type(claim21,claim)
        claim.date(claim21,2021_11_30)
        claim.policy(claim21,policy21)
        claim.hospitalization(claim21,hospitalization21)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% hospitalization
        %%% what is the format for ids?
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(hospitalization01,hospitalization)
        hospitalization.patient(hospitalization01,alan_arrogant)
        hospitalization.hospital(hospitalization01,johns_hopkins)
        hospitalization.diagnosis(hospitalization01,ulcer)
        hospitalization.startdate(hospitalization01,2017_05_03)
        hospitalization.starttime(hospitalization01,12_00_00)
        hospitalization.enddate(hospitalization01,2017_05_04)
        hospitalization.endtime(hospitalization01,12_00_00)

        type(hospitalization04,hospitalization)
        hospitalization.patient(hospitalization04,donna_daring)
        hospitalization.hospital(hospitalization04,mass_general)
        hospitalization.diagnosis(hospitalization04,gastric_polyp)
        hospitalization.startdate(hospitalization04,2017_05_03)
        hospitalization.starttime(hospitalization04,12_00_00)
        hospitalization.enddate(hospitalization04,2017_05_04)
        hospitalization.endtime(hospitalization04,12_00_00)

        type(hospitalization17,hospitalization)
        hospitalization.patient(hospitalization17,kitty_kat)
        hospitalization.hospital(hospitalization17,mass_general)
        hospitalization.diagnosis(hospitalization17,broken_leg)
        hospitalization.cause(hospitalization17,circumstance17)
        hospitalization.startdate(hospitalization17,2021_07_23)
        hospitalization.starttime(hospitalization17,01_00_00)
        hospitalization.enddate(hospitalization17,2021_07_23)
        hospitalization.endtime(hospitalization17,10_00_00)

        type(hospitalization21,hospitalization)
        hospitalization.patient(hospitalization21,sally_squirrel)
        hospitalization.hospital(hospitalization21,johns_hopkins)
        hospitalization.physician(hospitalization21,kildare)
        hospitalization.physicianref(hospitalization21,yes)
        hospitalization.diagnosis(hospitalization21,sprained_ankle)
        hospitalization.cause(hospitalization21,circumstance21)
        hospitalization.startdate(hospitalization21,2021_08_23)
        hospitalization.starttime(hospitalization21,22_00_00)
        hospitalization.enddate(hospitalization21,2021_08_24)
        hospitalization.endtime(hospitalization21,10_00_00)


        type(hospitalization51,hospitalization)
        hospitalization.patient(hospitalization51,alan_arrogant)
        hospitalization.hospital(hospitalization51,hospital_angeles)
        hospitalization.physician(hospitalization51,casey)
        hospitalization.physicianref(hospitalization51,yes)
        hospitalization.diagnosis(hospitalization51,ulcer)
        hospitalization.cause(hospitalization51,circumstance51)
        hospitalization.startdate(hospitalization51,2018_05_03)
        hospitalization.starttime(hospitalization51,10_00_00)
        hospitalization.enddate(hospitalization51,2018_05_06)
        hospitalization.endtime(hospitalization51,12_00_00)

        type(hospitalization52,hospitalization)
        hospitalization.patient(hospitalization52,bill_boring)
        hospitalization.hospital(hospitalization52,hospital_angeles)
        hospitalization.physician(hospitalization52,casey)
        hospitalization.physicianref(hospitalization52,yes)
        hospitalization.diagnosis(hospitalization52,asthma)
        hospitalization.startdate(hospitalization52,2018_09_04)
        hospitalization.starttime(hospitalization52,22_00_00)
        hospitalization.enddate(hospitalization52,2018_09_05)
        hospitalization.endtime(hospitalization52,15_00_00)

        type(hospitalization53,hospitalization)
        hospitalization.patient(hospitalization53,cathy_careful)
        hospitalization.hospital(hospitalization53,hospital_de_barcelona)
        hospitalization.physicianref(hospitalization53,yes)
        hospitalization.diagnosis(hospitalization53,gastric_polyp)
        hospitalization.startdate(hospitalization53,2018_09_29)
        hospitalization.starttime(hospitalization53,12_00_00)
        hospitalization.enddate(hospitalization53,2018_09_29)
        hospitalization.endtime(hospitalization53,23_00_00)

        type(hospitalization54,hospitalization)
        hospitalization.patient(hospitalization54,donna_daring)
        hospitalization.hospital(hospitalization54,hospital_de_barcelona)
        hospitalization.physicianref(hospitalization54,yes)
        hospitalization.diagnosis(hospitalization54,gastric_polyp)
        hospitalization.startdate(hospitalization54,2020_01_22)
        hospitalization.starttime(hospitalization54,12_00_00)
        hospitalization.enddate(hospitalization54,2020_01_27)
        hospitalization.endtime(hospitalization54,08_00_00)

        type(hospitalization55,hospitalization)
        hospitalization.patient(hospitalization55,frank_frank)
        hospitalization.hospital(hospitalization55,american_hospital)
        hospitalization.physicianref(hospitalization55,yes)
        hospitalization.diagnosis(hospitalization55,intervertebral_disc_disorder)
        hospitalization.startdate(hospitalization55,2019_03_19)
        hospitalization.starttime(hospitalization55,15_00_00)
        hospitalization.enddate(hospitalization55,2019_03_20)
        hospitalization.endtime(hospitalization55,13_00_00)

        type(hospitalization56,hospitalization)
        hospitalization.patient(hospitalization56,gary_grump)
        hospitalization.hospital(hospitalization56,hospital_de_barcelona)
        hospitalization.diagnosis(hospitalization56,pneumonia)
        hospitalization.startdate(hospitalization56,2017_04_03)
        hospitalization.starttime(hospitalization56,12_00_00)
        hospitalization.enddate(hospitalization56,2017_04_06)
        hospitalization.endtime(hospitalization56,12_00_00)

        type(hospitalization57,hospitalization)
        hospitalization.patient(hospitalization57,helen_heavenly)
        hospitalization.hospital(hospitalization57,hospital_de_barcelona)
        hospitalization.diagnosis(hospitalization57,broken_arm)
        hospitalization.startdate(hospitalization57,2020_10_01)
        hospitalization.starttime(hospitalization57,07_00_00)
        hospitalization.enddate(hospitalization57,2020_10-02)
        hospitalization.endtime(hospitalization57,14_00_00)

        type(hospitalization58,hospitalization)
        hospitalization.patient(hospitalization58,ivan_illegible)
        hospitalization.hospital(hospitalization58,american_hospital)
        hospitalization.diagnosis(hospitalization58,appendicitis)
        hospitalization.startdate(hospitalization58,2017_07_23)
        hospitalization.starttime(hospitalization58,08_00_00)
        hospitalization.enddate(hospitalization58,2017_07_25)
        hospitalization.endtime(hospitalization58,11_00_00)

        type(hospitalization59,hospitalization)
        hospitalization.patient(hospitalization59,oren_overbearing)
        hospitalization.hospital(hospitalization59,hospital_samaritano)
        hospitalization.diagnosis(hospitalization59,intervertebral_disc_disorder)
        hospitalization.startdate(hospitalization59,2020_04_17)
        hospitalization.starttime(hospitalization59,15_00_00)
        hospitalization.enddate(hospitalization59,2020_04_19)
        hospitalization.endtime(hospitalization59,16_00_00)

        type(hospitalization60,hospitalization)
        hospitalization.patient(hospitalization60,paul_pompous)
        hospitalization.hospital(hospitalization60,hospital_de_barcelona)
        hospitalization.diagnosis(hospitalization60,malaria)
        hospitalization.startdate(hospitalization60,2017_10_24)
        hospitalization.starttime(hospitalization60,22_00_00)
        hospitalization.enddate(hospitalization60,2017_10_26)
        hospitalization.endtime(hospitalization60,20_00_00)

        type(hospitalization61,hospitalization)
        hospitalization.patient(hospitalization61,polly_syllabic)
        hospitalization.hospital(hospitalization61,bangkok_hospital)
        hospitalization.diagnosis(hospitalization61,respiratory_infection)
        hospitalization.startdate(hospitalization61,2019_03_10)
        hospitalization.starttime(hospitalization61,15_00_00)
        hospitalization.enddate(hospitalization61,2019_03_12)
        hospitalization.endtime(hospitalization61,19_00_00)

        type(hospitalization62,hospitalization)
        hospitalization.patient(hospitalization62,tanya_terrible)
        hospitalization.hospital(hospitalization62,hospital_de_barcelona)
        hospitalization.diagnosis(hospitalization62,cataract)
        hospitalization.startdate(hospitalization62,2019_11_16)
        hospitalization.starttime(hospitalization62,11_00_00)
        hospitalization.enddate(hospitalization62,2019_11_17)
        hospitalization.endtime(hospitalization62,12_00_00)

        type(hospitalization63,hospitalization)
        hospitalization.patient(hospitalization63,aaron_aardvark)
        hospitalization.hospital(hospitalization63,martin_luther)
        hospitalization.diagnosis(hospitalization63,kidney_stones)
        hospitalization.startdate(hospitalization63,2019_07_07)
        hospitalization.starttime(hospitalization63,08_00_00)
        hospitalization.enddate(hospitalization63,2019_07_09)
        hospitalization.endtime(hospitalization63,13_00_00)

        type(hospitalization64,hospitalization)
        hospitalization.patient(hospitalization64,belinda_bat)
        hospitalization.hospital(hospitalization64,hospital_de_barcelona)
        hospitalization.diagnosis(hospitalization64,back_pain)
        hospitalization.startdate(hospitalization64,2020_12_17)
        hospitalization.starttime(hospitalization64,11_00_00)
        hospitalization.enddate(hospitalization64,2020_12_18)
        hospitalization.endtime(hospitalization64,11_00_00)

        type(hospitalization65,hospitalization)
        hospitalization.patient(hospitalization65,calvin_carp)
        hospitalization.hospital(hospitalization65,royal_london)
        hospitalization.diagnosis(hospitalization65,back_pain)
        hospitalization.startdate(hospitalization65,2019_04_07)
        hospitalization.starttime(hospitalization65,21_00_00)
        hospitalization.enddate(hospitalization65,2019_04_09)
        hospitalization.endtime(hospitalization65,10_00_00)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% circumstances = accidents or events or illnesses
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(circumstance17,accident)
        accident.subject(circumstance17,kitty_kat)
        accident.activity(circumstance17,skydiving)
        accident.country(circumstance17,usa)
        accident.date(circumstance17,2021_07_23)

        type(circumstance21,accident)
        accident.subject(circumstance21,sally_squirrel)
        accident.activity(circumstance21,dancing)
        accident.country(circumstance21,usa)
        accident.date(circumstance21,2021_08_23)

        type(circumstance51,illness)
        illness.date(circumstance51,2017_05_03)
        illness.physician(circumstance51,casey)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    </textarea>
    
    <!--=======================================================================-->
    
    <p id='rules_label' class='readonly_textarea_label' style='display:none'>Default Rules</p>
    <textarea id='rules' class='readonly_textarea' type='text/hrf' readonly rows='12' cols='96' wrap='soft' style='display:none'>
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Semantic Rules
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% recommendations
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        claim.recommendation(C,pay) :-
            plan_in_effect(C) &
            ~partial_day(C) &
            evaluate(countofall(E,exclusion(C,E)),0)

        claim.recommendation(C,decline) :- partial_day(C)
        claim.recommendation(C,decline) :- exclusion(C,E)

        plan_in_effect(C) :-
            claim.policy(C,P) &
            claim.hospitalization(C,Z) &
            policy.startdate(P,PS) &
            policy.enddate(P,PE) &
            hospitalization.startdate(Z,ZS) &
            hospitalization.enddate(Z,ZE) &
            overlap(PS,PE,ZS,ZE)

        partial_day(C) :-
            claim.hospitalization(C,Z) &
            duration(Z,DURATION) &
            less(DURATION,86400000)

        duration(Z,DURATION) :-
            hospitalization.startdate(Z,SD) &
            hospitalization.starttime(Z,ST) &
            hospitalization.enddate(Z,ED) &
            hospitalization.endtime(Z,ET) &
            datetimetotimestamp(SD,ST,SS) &
            datetimetotimestamp(ED,ET,ES) &
            evaluate(minus(ES,SS),DURATION)

        exclusion(C,4.3m) :- claim.exclusion(C,preexist)

        exclusion(C,4.3i) :-
            claim.hospitalization(C,Z) &
            hospitalization.cause(Z,X) &
            accident.activity(X,skydiving)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% insurance-related definitions
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        person.policy(X,Y) :- policy.insuree(Y,X)
        person.policy(X,Y) :- policy.dependent(Y,X)

        person.claim(X,Y) :-
            hospitalization.patient(H,X) &
            claim.hospitalization(Y,H)

        policy.claim(X,Y) :- claim.policy(Y,X)


        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% geography-related definitions
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        same_continent(C1,C2) :- 
            country.continent(C1,X) &
            country.continent(C2,X)

        adjacent_continent_countries(C1,C2) :-
            country.continent(C1,X1) &
            country.continent(C2,X2) &
            adjacent_continent(X1,X2)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% general definitions and predefined relations
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        overlap(PS,PE,ZS,ZE) :-
            evaluate(stringmin(ZS,PE),ZS) &
            evaluate(stringmin(PS,ZE),PS)

        datetimetotimestamp(DATE,TIME,STAMP) :-
            evaluate(parsedate(DATE),[Y,M,D]) &
            evaluate(parsetime(TIME),[H,N,S]) &
            evaluate(maketimestamp(Y,M,D,H,N,S),STAMP)

        parsedate(DATE) :=
            map(readstring,tail(matches(stringify(DATE),"(....)_(..)_(..)")))

        parsetime(TIME) :=
            map(readstring,tail(matches(stringify(TIME),"(..)_(..)_(..)")))

        leq(X,Y) :- evaluate(min(X,Y),X)
        less(X,Y) :- evaluate(min(X,Y),X) & distinct(X,Y)

        head(X!L) := X
        tail(X!L) := L

        %%% number relations, e.g. less, greater
        %%% string relations, e.g. stringappend
        %%% date relations, e.g. dateplus
        %%% and so forth...

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    </textarea>
    
    <!--=======================================================================-->

    <p id='metadata_label' class='readonly_textarea_label' style='display:none'>Default Metadata</p>
    <textarea id='metadata' class='readonly_textarea' readonly rows='12' cols='96' wrap='soft' style='display:none'>
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% General Classes
        %%% Version 2 - version 1 with P-L's revisions & changes to handle Chubb cases
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% person
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(person,class)
        attribute(person,person.firstname)
        attribute(person,person.lastname)
        attribute(person,person.gender)
        attribute(person,person.dob)
        attribute(person,person.parent)
        attribute(person,person.nationality)
        attribute(person,person.countryofresidence)
        attribute(person,person.occupation)
        attribute(person,person.phone)
        attribute(person,person.mobile)
        attribute(person,person.email)

        type(person.name,attributerelation)
        domain(person.name,person)
        range(person.name,string)
        unique(person.name,no)
        total(person.name,yes)

        type(person.gender,attributerelation)
        domain(person.gender,person)
        range(person.gender,gender)
        unique(person.gender,yes)
        total(person.gender,yes)

        type(person.dob,attributerelation)
        domain(person.dob,person)
        range(person.dob,date)
        unique(person.dob,yes)
        total(person.dob,yes)

        type(person.parent,attributerelation)
        domain(person.parent,person)
        range(person.parent,person)
        unique(person.parent,no)
        total(person.parent,yes)

        type(person.nationality,attributerelation)
        domain(person.nationality,person)
        range(person.nationality,country)
        unique(person.nationality,no)
        total(person.nationality,yes)

        type(person.countryofresidence,attributerelation)
        domain(person.countryofresidence,person)
        range(person.countryofresidence,country)
        unique(person.countryofresidence,yes)
        total(person.countryofresidence,yes)

        type(person.occupation,attributerelation)
        domain(person.occupation,person)
        range(person.occupation,profession)
        unique(person.occupation,yes)
        total(person.occupation,yes)

        type(person.phone,attributerelation)
        domain(person.phone,person)
        range(person.phone,string)
        unique(person.phone,no)
        total(person.phone,no)

        type(person.mobile,attributerelation)
        domain(person.mobile,person)
        range(person.mobile,string)
        unique(person.mobile,no)
        total(person.mobile,no)

        type(person.email,attributerelation)
        domain(person.email,person)
        range(person.email,string)
        unique(person.email,no)
        total(person.email,no)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% hospital
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(hospital,class)
        attribute(hospital,hospital.name)
        attribute(hospital,hospital.country)

        type(hospital.name,attributerelation)
        domain(hospital.name,hospital)
        range(hospital.name,string)
        unique(hospital.name,yes)
        total(hospital.name,yes)

        type(hospital.country,attributerelation)
        domain(hospital.country,hospital)
        range(hospital.country,country)
        unique(hospital.country,yes)
        total(hospital.country,yes)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% country
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(country,class)
        attribute(country,country.name)
        attribute(country,country.continent)

        type(country.name,attributerelation)
        domain(country.name,country)
        range(country.name,string)
        total(country.continent,yes)
        unique(country.continent,yes)

        type(country.continent,attributerelation)
        domain(country.continent,country)
        range(country.continent,continent)
        total(country.continent,yes)
        unique(country.continent,yes)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Classes without attributes
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(boolean,class)
        type(continent,class)
        type(date,class)
        type(gender,class)
        type(number,class)
        type(profession,class)
        type(string,class)
        type(time,class)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Insurance Classes
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% policy
        %%% endorsements forthcoming
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(policy,class)
        attribute(policy,policy.insuree)
        attribute(policy,policy.dependent)
        attribute(policy,policy.startdate)
        attribute(policy,policy.enddate)

        type(policy.insuree,attributerelation)
        domain(policy.insuree,policy)
        range(policy.insuree,person)
        unique(policy.insuree,yes)
        total(policy.insuree,yes)

        type(policy.dependent,attributerelation)
        domain(policy.dependent,policy)
        range(policy.dependent,person)
        unique(policy.dependent,no)
        total(policy.dependent,no)

        type(policy.startdate,attributerelation)
        domain(policy.startdate,policy)
        range(policy.startdate,date)
        unique(policy.startdate,yes)
        total(policy.startdate,yes)

        type(policy.enddate,attributerelation)
        domain(policy.enddate,policy)
        range(policy.enddate,date)
        unique(policy.enddate,yes)
        total(policy.enddate,yes)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% claim
        %%% claimlines forthcoming
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(claim,class)
        attribute(claim,claim.date)
        attribute(claim,claim.policy)
        attribute(claim,claim.hospitalization)
        attribute(claim,claim.priorhospitalization)
        attribute(claim,claim.disposition)
        attribute(claim,claim.amount)
        attribute(claim,claim.justification)

        type(claim.date,attributerelation)
        domain(claim.date,claim)
        range(claim.date,date)
        unique(claim.date,yes)
        total(claim.date,no)

        type(claim.policy,attributerelation)
        domain(claim.policy,claim)
        range(claim.policy,policy)
        unique(claim.policy,yes)
        total(claim.policy,yes)

        type(claim.hospitalization,attributerelation)
        domain(claim.hospitalization,claim)
        range(claim.hospitalization,hospitalization)
        unique(claim.hospitalization,no)
        total(claim.hospitalization,yes)

        type(claim.priorhospitalization,attributerelation)
        domain(claim.priorhospitalization,claim)
        range(claim.priorhospitalization,hospitalization)
        unique(claim.priorhospitalization,no)
        total(claim.priorhospitalization,no)

        type(claim.disposition,attributerelation)
        domain(claim.disposition,claim)
        range(claim.disposition,disposition)
        unique(claim.disposition,yes)
        total(claim.disposition,yes)

        type(claim.amount,attributerelation)
        domain(claim.amount,claim)
        range(claim.amount,number)
        unique(claim.amount,yes)
        total(claim.amount,yes)

        type(claim.justification,attributerelation)
        domain(claim.justification,claim)
        range(claim.justification,string)
        unique(claim.justification,yes)
        total(claim.justification,yes)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% hospitalization
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(hospitalization,class)
        attribute(hospitalization,hospitalization.patient)
        attribute(hospitalization,hospitalization.hospital)
        attribute(hospitalization,hospitalization.diagnosis)
        attribute(hospitalization,hospitalization.cause)
        attribute(hospitalization,hospitalization.startdate)
        attribute(hospitalization,hospitalization.starttime)
        attribute(hospitalization,hospitalization.enddate)
        attribute(hospitalization,hospitalization.endtime)

        type(hospitalization.patient,attributerelation)
        domain(hospitalization.patient,hospitalization)
        range(hospitalization.patient,person)
        unique(hospitalization.patient,yes)
        total(hospitalization.patient,yes)

        type(hospitalization.hospital,attributerelation)
        domain(hospitalization.hospital,hospitalization)
        range(hospitalization.hospital,hospital)
        unique(hospitalization.hospital,yes)
        total(hospitalization.hospital,yes)

        type(hospitalization.diagnosis,attributerelation)
        domain(hospitalization.diagnosis,hospitalization)
        range(hospitalization.diagnosis,diagnosis)
        unique(hospitalization.diagnosis,no)
        total(hospitalization.diagnosis,yes)

        type(hospitalization.cause,attributerelation)
        domain(hospitalization.cause,hospitalization)
        range(hospitalization.cause,event)
        unique(hospitalization.cause,no)
        total(hospitalization.cause,no)

        type(hospitalization.patient,attributerelation)
        domain(hospitalization.patient,hospitalization)
        range(hospitalization.patient,hospital)
        unique(hospitalization.patient,yes)
        total(hospitalization.patient,yes)

        type(hospitalization.startdate,attributerelation)
        domain(hospitalization.startdate,policy)
        range(hospitalization.startdate,date)
        unique(hospitalization.startdate,yes)
        total(hospitalization.startdate,yes)

        type(hospitalization.starttime,attributerelation)
        domain(hospitalization.starttime,policy)
        range(hospitalization.starttime,time)
        unique(hospitalization.starttime,yes)
        total(hospitalization.starttime,yes)

        type(hospitalization.enddate,attributerelation)
        domain(hospitalization.enddate,policy)
        range(hospitalization.enddate,date)
        unique(hospitalization.enddate,yes)
        total(hospitalization.enddate,yes)

        type(hospitalization.endtime,attributerelation)
        domain(hospitalization.endtime,policy)
        range(hospitalization.endtime,date)
        unique(hospitalization.endtime,yes)
        total(hospitalization.endtime,yes)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%% Classes with only name attributes
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        type(disposition,class)
        type(diagnosis,class)
        type(event,class)

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    </textarea>

    <!--=======================================================================-->

    <!-- Expected format of english templates is specified in localstorage.js above the getTemplates() function -->
    <p id='english_templates_label' class='readonly_textarea_label' style='display:none'>Default English Templates</p>
    <textarea id='english_templates' class='readonly_textarea' readonly rows='12' cols='96' wrap='soft' style='display:none'>
        %(claim.policy(C,P),"the policy of $C$ is $P$")
        (policy.startdate(P,S),"$P$ began on $S$")
        (policy.enddate(P,E),"$P$ ended on $E$")
        (claim.recommendation(C,decline),"$C$ was declined")
        (claim.recommendation(C,pay),"$C$ was paid")
        (plan_in_effect(C),"a plan was in effect during the period of $C$")
        (claim.exclusion(C,preexist),"the affliction in $C$ is a pre-existing condition")
        (partial_day(C),"the hospital stay of $C$ lasted less than one day")
        (~partial_day(C),"the hospital stay of $C$ lasted at least one day")
        %(claim.hospitalization(C,Z),"the hospitalization of $C$ is $Z$")
        (duration(Z,T),"the duration of $Z$ was $T$ milliseconds")
        (less(X,Y),"$X$ is less than $Y$")
        (exclusion(C,4.3i),"the claim violates exclusion 4.3i")
        (exclusion(C,4.3m),"the claim violates exclusion 4.3m")
        (evaluate(countofall(E,exclusion(C,E)),0),"there were no exclusions")
        (datetimetotimestamp(D,T,S),"the timestamp for date $D$ and time $T$ is $S$")
        (hospitalization.startdate(Z,S),"$Z$ began on $S$")
        (hospitalization.starttime(Z,T),"$Z$ began at $T$")
        (hospitalization.enddate(Z,S),"$Z$ ended on $S$")
        (hospitalization.endtime(Z,T),"$Z$ ended at $T$")
        (hospitalization.cause(Z,C),"$Z$ was caused by $C$")
        (accident.activity(C,A),"the activity in $C$ was $A$")
        (same_continent(C1,C2),"$C1$ and $C2$ reside on the same continent")
        (adjacent_continent_countries(C1,C2), "$C1$ and $C2$ are on adjacent continents")
        (adjacent_continent(X1,X2), "$X1$ and $X2$ are adjacent")
        %(country.continent(C,X),"$X$ is the continent on which $C$ resides")
        (overlap(XS,XE,YS,YE),"[$XS$, $XE$] overlaps with [$YS$, $YE$]")
        (distinct(X,Y),"$X$ is not equal to $Y$")
        (evaluate(parsedate(DATE),[Y,M,D]),"$DATE$ parses as [$Y$,$M$,$D$]")
        (evaluate(parsetime(TIME),[H,M,S]),"$TIME$ parses as [$H$,$M$,$S$]")
        (evaluate(maketimestamp(Y,M,D,H,N,S),TS),"the timestamp for [$Y$,$M$,$D$,$H$,$N$,$S$] is $TS$")
        (evaluate(min(X,Y),Z),"the minimum of $X$ and $Y$ is $Z$")
        (evaluate(stringmin(X,Y),Z),"the minimum of $X$ and $Y$ is $Z$")
        (evaluate(minus(X,Y),Z),"$X$ minus $Y$ is $Z$")
        (countofall(E,exclusion(C,E),0),"there is no exclusion for $C$")
        % Procedural templates for unique attributes
        (claim.hospitalization, "hospitalization", "listed in $C$")
        (country.continent, "continent", "on which $C$ resides")
        (claim.policy, "policy", "under which $C$ was filed")
    </textarea>

    <!--=======================================================================-->
        </div>
    </body>
    
    <!--=======================================================================-->
    
    </html>
    