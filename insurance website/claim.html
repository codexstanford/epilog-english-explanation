
<html>

    <!--=======================================================================-->
    
    <head>
      <script type='text/javascript' src='./src/epilog.js'></script>
      <script type='text/javascript' src='./src/worksheets.js'></script>
      <script src="./src/calendars.js"></script>
      <script src='./src/localstorage.js'></script>
      <script>
    
    function showalert()
     {alert("changes saved")}
    
      </script>
      <style>
    
    .container
     {width: 1000px; 
      height: auto; 
      border: 2px solid rebeccapurple;
      border-radius: 5px;
      background-color: #e6f3f8;
      border-color: #2e5984;
      padding:5px;
      margin:10px;}
    
      </style>
    </head>
    
    <!--=======================================================================-->
    
    <!-- this is the initialize from localstorage, not worksheets-->
    <body onload="initialize()">
      <center>
        <table width='640' cellspacing='0' cellpadding='0'>
          <tr>
            <td>
    
    <!--=======================================================================-->
    
    <table width='100%'>
      <tr>
        <td width='200' align='center'>
          <a href='monitor.html?room=codex' target='_blank'><img src='./src/codex.jpg' width=120'/></a>
        </td>
        <td width='*' align='center' valign='center' style='font-size:42px'><b>Hospital Cash Claim Form</b></td>
        <td width='200' style='font-size:18px;cursor:pointer'>
          <span id='user'>Steve Squirrel</span><br/>
          <span onclick='alert("Disabled for this demo.")'>Sign Out</span>
        </td>
      </tr>
    </table>
    
    <!--=======================================================================-->
    
    <div id="holderinfo" class="container" align='center'>
      <h2>Policy Information</h2>
    
      <table id='policies' cellspacing='0' cellpadding='4' border='1' bgcolor='#ffffff'>
        <thead>
          <tr bgcolor='#bbbbdd'>
            <th width='100'>Policy</th>
            <th width='160' displaystyle='stringfield'>Type</th>
            <th width='160'>Begin Coverage</th>
            <th width='160'>End Coverage</th>
        </tead>
      </table>
    
      <a href='browser.html?room=codex&id=claim21' style='color:#000000;text-decoration:none' target='_blank'><h2>Recommendation</h2></a>
    
      <table class="pred" cellspacing='0' cellpadding='4' border='1' bgcolor='#ffffff'>
        <tr class="pred" bgcolor='#bbbbdd'>
          <th width='160'>Benefit</th>
          <th width='160'>Claim accepted?</th>
          <th id="explanation1"  width='160'>Explanation</th>
        </tr>
        <tr class="pred">
          <th class="pred">Hospital Cash</th>
          <td class="pred" id="dailypred" align='center'></td>
          <td class="pred" id="explanation2" align='center'>Explain</td>
        </tr>
      </table>
    
      <br/>
    
    </div>
    
    <!--=======================================================================-->
    
    <div id="genclaim" class="container">
      <a href='browser.html?room=codex&id=hospitalization21' style='color:#000000;text-decoration:none' target='_blank'><h2>Hospitalization Detail</h2></a>
    
      <table cellspacing='0' cellpadding='2'>
        <tr>
          <td>
      <label for="patient">Patient:</label>
      <select type='text' id='patient' onchange='handle(this)'>
        <option value='blank'></option>
        <option value='sally_squirrel'>Sally Squirrel</option>
        <option value='steve_squirrel'>Steve Squirrel</option>   
        <option value='susan_squirrel'>Susan Squirrel</option>
      </select>
    
      <label for="diagnosis">Diagnosis:</label>
      <select type='text' id='diagnosis' onchange='handle(this)'>
        <option value='blank'></option>
        <option value='appendicitis'>Appendicitis</option>
        <option value='asthma'>Asthma</option>
        <option value='broken_arm'>Back pain</option>
        <option value='broken_arm'>Broken arm</option>
        <option value='broken_leg'>Broken leg</option>  
        <option value='cataract'>Cataract</option>
        <option value='gastric_polyp'>Gastric Polyp</option>
        <option value='intervertebral_disc_disorder'>Intervertebral disc disorderp</option>
        <option value='kidney_stones'>Kidney stones</option>
        <option value='malaria'>Malaria</option>
        <option value='pneumonia'>Pneumonia</option>
        <option value='respiratory_infection'>Respiratory infection</option>
        <option value='sprained_ankle'>Sprained ankle</option>
        <option value='ulcer'>Ulcer</option>
      </select>
          </td>
        </tr>
    
        <tr>
          <td>
      <label for="hospital">Hospital:</label>
      <select type='text' id='hospital' onchange='handle(this)'>
        <option value='blank'></option>
        <option value='american_hospital'>American Hospital of Paris</option>    
        <option value='bangkok_hospital'>Bangkok Hospital</option>    
        <option value='hospital_angeles'>Hospital Angeles Mexico</option>    
        <option value='hospital_de_barcelona'>Hospital de Barcelona</option>    
        <option value='hospital_samaritano'>Hospital Samaritano</option>    
        <option value='johns_hopkins'>Johns Hopkins Medical Center</option>    
        <option value='martin_luther'>Martin Luther</option>    
        <option value='stanford_hospital'>Stanford Hospital</option>    
        <option value='mass_general'>Massachusetts General Hospital</option>    
        <option value='royal_london'>Royal London Hospital</option>    
      </select>
    
      <label for="physician">Physician:</label>
      <select type='text' id='physician' onchange='handle(this)'>
        <option value='blank'></option>
        <option value='casey'>Dr. Casey</option>
        <option value='kildare'>Dr. Kildare</option>
        <option value='mccoy'>Dr. McCoy</option>   
        <option value='spock'>Dr. Spock</option>
      </select>
          </td>
        </tr>
    
        <tr>
          <td>
      <label for="startdate">Date Admitted:</label>
      <input type='text' id='startdatetext' onclick='modbutton(this)' readonly/>
      <calendar id='startdate' style='display:none'></calendar>
    
      <label for="starttime">Time Admitted:</label>
      <select type='text' id='starttime' onchange='handle(this)'>
        <option value='00_00_00'>Midnight</option>
        <option value='01_00_00'>1:00 am</option>
        <option value='02_00_00'>2:00 am</option>
        <option value='03_00_00'>3:00 am</option>
        <option value='04_00_00'>4:00 am</option>
        <option value='05_00_00'>5:00 am</option>
        <option value='06_00_00'>6:00 am</option>
        <option value='07_00_00'>7:00 am</option>
        <option value='08_00_00'>8:00 am</option>
        <option value='09_00_00'>9:00 am</option>
        <option value='10_00_00'>10:00 am</option>
        <option value='11_00_00'>11:00 am</option>
        <option value='12_00_00' selected>Noon</option>
        <option value='13_00_00'>1:00 pm</option>
        <option value='14_00_00'>2:00 pm</option>
        <option value='15_00_00'>3:00 pm</option>
        <option value='16_00_00'>4:00 pm</option>
        <option value='17_00_00'>5:00 pm</option>
        <option value='18_00_00'>6:00 pm</option>
        <option value='19_00_00'>7:00 pm</option>
        <option value='20_00_00'>8:00 pm</option>
        <option value='21_00_00'>9:00 pm</option>
        <option value='22_00_00'>10:00 pm</option>
        <option value='23_00_00'>11:00 pm</option>
      </select>
          </td>
        </tr>
    
        <tr>
          <td>
      <label for="leavedate">Date Discharged:</label>
      <input type='text' id='leavedatetext' onclick='modbutton(this)' readonly/>
      <calendar id='leavedate' style='display:none'></calendar>
    
      <label for="leavetime">Time Discharged:</label>
      <select type='text' id='leavetime' onchange='handle(this)'>
        <option value='00_00_00'>Midnight</option>
        <option value='01_00_00'>1:00 am</option>
        <option value='02_00_00'>2:00 am</option>
        <option value='03_00_00'>3:00 am</option>
        <option value='04_00_00'>4:00 am</option>
        <option value='05_00_00'>5:00 am</option>
        <option value='06_00_00'>6:00 am</option>
        <option value='07_00_00'>7:00 am</option>
        <option value='08_00_00'>8:00 am</option>
        <option value='09_00_00'>9:00 am</option>
        <option value='10_00_00'>10:00 am</option>
        <option value='11_00_00'>11:00 am</option>
        <option value='12_00_00' selected>Noon</option>
        <option value='13_00_00'>1:00 pm</option>
        <option value='14_00_00'>2:00 pm</option>
        <option value='15_00_00'>3:00 pm</option>
        <option value='16_00_00'>4:00 pm</option>
        <option value='17_00_00'>5:00 pm</option>
        <option value='18_00_00'>6:00 pm</option>
        <option value='19_00_00'>7:00 pm</option>
        <option value='20_00_00'>8:00 pm</option>
        <option value='21_00_00'>9:00 pm</option>
        <option value='22_00_00'>10:00 pm</option>
        <option value='23_00_00'>11:00 pm</option>
      </select>
          </td>
        </tr>
    
        <tr id="ineffectpopup" style="display:none">
          <td><span style="color:red">WARNING: The date of your admittance to the hospital is before when your plan began. You will not be covered for this claim.</span></td>
        </tr>
    
        <tr id="partialdaypopup" style="display:none">
          <td><span style="color:red">WARNING: Your hospital stay was less than 24 hours.  You will not be covered for this claim.</span></td>
        </tr>
    
        <tr id="max730popup" style="display:none">
          <td><span style="color:orange">WARNING: The time between your admittance and discharge from the hospital exceeds 730 days, which you are not covered for.</span></td>
        </tr>
    
        <tr>
          <td>
      <label>Was hospitalization recommended by a practicing physician?</label>
      <select id="physicianref" onchange="modselector(this)">
        <option value="blank"></option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
          </td>
        </tr>
    
        <tr id='physicianrefpopup' style="display:none">
          <td><span style="color:red">WARNING: Since your treatment was not deemed necessary by a practicing physician, you will not be covered for this claim.</span></td>
        </tr>
    
    <!--  <label for="priorhosp">Has the patient been hospitalized for this illness or injury before?</label>
      <select id="priorhosp" onchange="modselector(this)">
        <option value="unknown"></option>
        <option value="yespriorhosp">Yes</option>
        <option value="nopriorhosp">No</option>
      </select>
    
      <div id="priorhospcal" style="display:none">
        <label for="dateprior">Date Discharged:</label>
        <input type='text' id='datepriortext' onclick='modbutton(this)' readonly/>
        <calendar id='dateprior' style='display:none'></calendar>
    
        <div id="within1yrpopup" style="display:none">
          <span class="popuptext" style="color:red">WARNING: You were hospitalized for the same condition less than one year ago. You will not be covered for this.</span>
        </div>    
      </div>-->
    
        <tr>
          <td><label>Did the condition result from an accident or an ongoing condition, illness, or disease?</label>
      <select id="claimtype" onchange="modselector(this)">
        <option value="blank"></option>
        <option value="accident">Accident</option>
        <option value="illness">Illness</option>
      </select>
          </td>
        </tr>
      </table>
    
      <br/>
    
    </div>
    
    <!--=======================================================================-->
    
    <div id="claimtype(accident)" style="display:none" class="container"> 
      <h2>Accident Information</h2>
    
      <table cellspacing='0' cellpadding='2'>
    
        <tr>
          <td>
      <label>Subject:</label>
      <input type='text' id='accidentsubject' disabled/
          </td>
        </tr>
    
        <tr>
          <td>
      <label>Activity:</label>
      <select id="accidentactivity" onchange='handle(this)'>
        <option value='blank'></option>
        <option value='bicycling'>Bicycling</option>
        <option value='dancing'>Dancing</option>
        <option value='skydiving'>Skydiving</option>
      </select>
          </td>
        </tr>
    
        <tr>
          <td>
      <label>Country:</label>
      <select id="accidentcountry" onchange='handle(this)'>
        <option value='blank'></option>
      </select>
          </td>
        </tr>
    
        <tr>
          <td>
      <label for="accidentdate">Date:</label>
      <input type='text' id='accidentdatetext' onclick='modbutton(this)' readonly/>
      <calendar id='accidentdate' style='display:none'></calendar>
          </td>
        </tr>
    
        <tr id="accidentpopup" style="display:none">
          <td><span style="color:red">WARNING: Your accident is due to an extreme activity. You will not be covered for this claim.</span></td>
        </tr>
    
      </table>
      <br/>
    
    </div>
    
    <!--=======================================================================-->
    
    <div id="claimtype(illness)" style="display:none" class="container">
      <h2>Illness Information</h2>
    
      <table cellspacing='0' cellpadding='2'>
    
        <tr>
          <td>
      <label>Subject:</label>
      <input type='text' id='illnesssubject' disabled/
          </td>
        </tr>
    
        <tr>
          <td>
      <label>Date prior episode first noticed:</label> 
      <input type="text" id="priordatetext" onfocus="modbutton(this)" readonly>
      <calendar id="priordate" style="display:none"></calendar>
          </td>
        </tr>
    
        <tr>
          <td>
      <label for="consultation">Physician consulted:</label>
      <select type='text' id='consultation' onchange='handle(this)'>
        <option value='blank'></option>
        <option value='casey'>Dr. Casey</option>
        <option value='kildare'>Dr. Kildare</option>
        <option value='mccoy'>Dr. McCoy</option>   
        <option value='spock'>Dr. Spock</option>
      </select>
          </td>
        </tr>
    
      </table>
    
      <div id="consultationpopup" style="display:none">
        <span class="popuptext" style="color:red">WARNING: You have seen a medical professional for this treatment prior to your plan enrollment, this degree of awareness for an illness constitutes a pre-existing condition.</span>
      </div>
    
      <div id="priordatepopup" style="display:none">
        <span class="popuptext" style="color:orange">WARNING: The fact that you exhibited symptoms for this illness prior to when your plan was in effect.  You may not qualify for benefits; further review will be required.</span>
      </div>
    
      <br/>
    
    </div>
    
    <!--=======================================================================-->
    
        <!--<div id="thirdpartyform" class="container">
          <h2>Exclusions</h2>
    
          <div>
            <label>Check features of the situation that caused the insured person's injury or illness:</label>
            <table>
              <tr>
                <td>          <input type="checkbox" id="feature(nukerad)" onchange="modcheck(this)" /> nuclear radiation </td>
                <td>          <input type="checkbox" id="feature(nucreac)" onchange="modcheck(this)" /> nuclear reaction</td>
                <td>          <input type="checkbox" id="feature(radcont)" onchange="modcheck(this)" /> radioactive contamination</td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(selfharm)" onchange="modcheck(this)" /> self-harm               </td>
                <td>          <input type="checkbox" id="feature(aviationv" onchange="modcheck(this)" /> personal aviation               </td>
                <td>          <input type="checkbox" id="feature(suicidepact)" onchange="modcheck(this)" /> suicide pact               </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(suicide)" onchange="modcheck(this)" /> suicide               </td>
                <td>          <input type="checkbox" id="feature(dodrug)" onchange="modcheck(this)" /> a non-prescription drug  </td>
                <td>          <input type="checkbox" id="feature(drunkdrive)" onchange="modcheck(this)" /> driving with blood alcohol content above legal limit  </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(dodrug2)" onchange="modcheck(this)" /> prescription drug for alcoholism, addiction, mental disorder</td>
                <td>          <input type="checkbox" id="feature(cosmetic)" onchange="modcheck(this)" /> cosmetic surgery  </td>
                <td>          <input type="checkbox" id="feature(dental)" onchange="modcheck(this)" /> dental work  </td>
    
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(war)" onchange="modcheck(this)" /> declared or undeclared war  </td>
                <td>          <input type="checkbox" id="feature(riot)" onchange="modcheck(this)" /> riot or strike  </td>
                <td>          <input type="checkbox" id="feature(terror)" onchange="modcheck(this)" /> terrorism  </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(illegal1)" onchange="modcheck(this)" /> illegal act of the insured </td>
                <td>          <input type="checkbox" id="feature(illegal2)" onchange="modcheck(this)" /> illegal act of the associate(s)</td>
                <td>          <input type="checkbox" id="feature(homsult)" onchange="modcheck(this)" /> homicide or assault  </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(routine)" onchange="modcheck(this)" /> medical examination without impairment to normal health</td>
                <td>          <input type="checkbox" id="feature(evilsurg)" onchange="modcheck(this)" /> non-essential surgery  </td>
                <td>          <input type="checkbox" id="feature(preexist)" onchange="modcheck(this)"/> pre-existing medical condition  </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(aids)" onchange="modcheck(this)" /> autoimmune disorder such as HIV or AIDs</td>
                <td>          <input type="checkbox" id="feature(venereal)" onchange="modcheck(this)" /> venereal disease</td>
                <td>          <input type="checkbox" id="feature(fertility)" onchange="modcheck(this)" /> fertility treatment complications</td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(birthcontrol)" onchange="modcheck(this)" /> birth control complication</td>
                <td>          <input type="checkbox" id="feature(miscarriage)" onchange="modcheck(this)" /> miscarriage or abortion</td>
                <td>          <input type="checkbox" id="feature(childbirth)" onchange="modcheck(this)" /> childbirth </td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(circum)" onchange="modcheck(this)" /> circumcision</td>
                <td>          <input type="checkbox" id="feature(hereditary)" onchange="modcheck(this)" /> surgery for hereditary condition</td>
                <td>          <input type="checkbox" id="feature(congenital)" onchange="modcheck(this)" /> surgery for congenital disorder</td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(mental)" onchange="modcheck(this)" /> mental or emotional disorder</td>
                <td>          <input type="checkbox" id="feature(geriatric)" onchange="modcheck(this)" /> geriatric condition</td>
                <td>          <input type="checkbox" id="feature(fat)" onchange="modcheck(this)" /> weight improvement treatment</td>
              </tr>
              <tr>
                <td>          <input type="checkbox" id="feature(alcoholism)" onchange="modcheck(this)"/> alcoholism</td>
                <td>          <input type="checkbox" id="feature(restcure)" onchange="modcheck(this)"/> rest cures</td>
                <td>          <input type="checkbox" id="feature(sanatorium)" onchange="modcheck(this)"/> sanatorium treatment</td>
              </tr>
            </table>
    
        <div id="exclusionpopup" style="display:none">
          <span style="color:red">WARNING: Your claim has will not be covered due to an explicit exclusion.</span>
        </div>
    
        </div>
      </div>-->
    
    <!--=======================================================================-->
    
    <center>
      <input type='button' value='Load' onclick='doloaddata()'/>
      <input type='button' value='Save' onclick='dosavedata()'/>
    </center>
    
    <!--=======================================================================-->
       
    </body>
    
    <!--=======================================================================-->
    
    <textarea id="library" type="text/hrf" style="display:none">
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Semantic Rules
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% recommendations
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    claim.recommendation(C,pay) :-
      plan_in_effect(C) &
      ~partial_day(C) &
      evaluate(countofall(E,exclusion(C,E)),0)
    
    claim.recommendation(C,decline) :- partial_day(C)
    claim.recommendation(C,decline) :- exclusion(C,E)
    
    plan_in_effect(C) :-
      claim.policy(C,P) &
      claim.hospitalization(C,Z) &
      policy.startdate(P,PS) &
      policy.enddate(P,PE) &
      hospitalization.startdate(Z,ZS) &
      hospitalization.enddate(Z,ZE) &
      overlap(PS,PE,ZS,ZE)
    
    partial_day(C) :-
      claim.hospitalization(C,Z) &
      duration(Z,DURATION) &
      less(DURATION,86400000)
    
    duration(Z,DURATION) :-
      hospitalization.startdate(Z,SD) &
      hospitalization.starttime(Z,ST) &
      hospitalization.enddate(Z,ED) &
      hospitalization.endtime(Z,ET) &
      datetimetotimestamp(SD,ST,SS) &
      datetimetotimestamp(ED,ET,ES) &
      evaluate(minus(ES,SS),DURATION)
    
    exclusion(C,4.3m) :- claim.exclusion(C,preexist)
    
    exclusion(C,4.3i) :-
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.activity(X,skydiving)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% insurance-related definitions
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    person.policy(X,Y) :- policy.insuree(Y,X)
    person.policy(X,Y) :- policy.dependent(Y,X)
    
    person.claim(X,Y) :-
      hospitalization.patient(H,X) &
      claim.hospitalization(Y,H)
    
    policy.claim(X,Y) :- claim.policy(Y,X)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% general definitions and predefined relations
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    overlap(PS,PE,ZS,ZE) :-
      evaluate(stringmin(ZS,PE),ZS) &
      evaluate(stringmin(PS,ZE),PS)
    
    datetimetotimestamp(DATE,TIME,STAMP) :-
      evaluate(parsedate(DATE),[Y,M,D]) &
      evaluate(parsetime(TIME),[H,N,S]) &
      evaluate(maketimestamp(Y,M,D,H,N,S),STAMP)
    
    parsedate(DATE) :=
      map(readstring,tail(matches(stringify(DATE),"(....)_(..)_(..)")))
    
    parsetime(TIME) :=
      map(readstring,tail(matches(stringify(TIME),"(..)_(..)_(..)")))
    
    leq(X,Y) :- evaluate(min(X,Y),X)
    less(X,Y) :- evaluate(min(X,Y),X) & distinct(X,Y)
    
    head(X!L) := X
    tail(X!L) := L
    
    %%% number relations, e.g. less, greater
    %%% string relations, e.g. stringappend
    %%% date relations, e.g. dateplus
    %%% and so forth...
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Stylesheet Rules
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Initialization
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    load ::
      evaluate(parameter(id),C)
      ==> true(claim(C),local)
    
    load ::
      countofall(X,evaluate(parameter(id),X),0) &
      evaluate(stringify(timestamp()),TS) &
      evaluate(readstring(stringappend("claim",TS)),C) &
      evaluate(readstring(stringappend("policy",TS)),P) &
      evaluate(readstring(stringappend("hospitalization",TS)),Z)
      ==> true(claim(C),local) &
          type(C,claim) &
          claim.policy(C,P) &
          claim.hospitalization(C,Z) &
          type(P,policy) &
          policy.insuree(P,steve_squirrel) &
          policy.dependent(P,sally_squirrel) &
          policy.dependent(P,susan_squirrel) &
          type(Z,hospitalization)
    
    claim(C) :- true(claim(C),local)
    
    insuree(X) :-
      claim(C) &
      claim.policy(C,P) &
      policy.insuree(P,X)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Policy panel
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    innerhtml(user,NS) :-
      insuree(X) &
      person.firstname(X,FN) &
      person.lastname(X,LN) &
      stringappend(FN," ",LN,NS)
    
    rows(policies,L) :- setofall(R,row(policies,R),L)
    
    row(policies,policy(P,T,SD,ED)) :-
      insuree(X) &
      policy.insuree(P,X) &
      policy.type(P,T) &
      policy.startdate(P,SD) &
      policy.enddate(P,ED)
    
    
    innerhtml(dailypred,R) :-
      claim(C) &
      claim.recommendation(C,R)
    
    innerhtml(explanation2,LINK) :-
      claim(C) &
      claim.recommendation(C,R) &
      evaluate(stringify(delistify([claim.recommendation,C,R])),CS) &
      stringappend("<a href='justify.html?room=codex&test=testrelation(firstarg,secondarg)&conclusion=",CS,"' style='color:#0044bb;text-decoration:none;cursor:pointer' target='explanation'>Explain</a>",LINK)
    
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Hospitalization panel
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    options(patient,L) :- setofall(X,option(patient,X),L)
    
    option(patient,X) :-
      claim(C) &
      claim.policy(C,P) &
      policy.insuree(P,X)
    
    option(patient,X) :-
      claim(C) &
      claim.policy(C,P) &
      policy.dependent(P,X)
    
    
    value(patient,P) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.patient(Z,P)
    
    select(patient,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      distinct(P,blank)
      ==> hospitalization.patient(Z,P)
    
    select(patient,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.patient(Z,Q)
      ==> ~hospitalization.patient(Z,Q)
    
    
    value(hospital,H) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.hospital(Z,H)
    
    select(hospital,H) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      distinct(H,blank)
      ==> hospitalization.hospital(Z,H)
    
    select(hospital,H) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.hospital(Z,Q)
      ==> ~hospitalization.hospital(Z,Q)
    
    
    value(diagnosis,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.diagnosis(Z,D)
    
    select(diagnosis,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      distinct(D,blank)
      ==> hospitalization.diagnosis(Z,D)
    
    select(diagnosis,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.diagnosis(Z,Q)
      ==> ~hospitalization.diagnosis(Z,Q)
    
    
    value(physician,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.physician(Z,D)
    
    select(physician,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      distinct(D,blank)
      ==> hospitalization.physician(Z,D)
    
    select(physician,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.physician(Z,Q)
      ==> ~hospitalization.physician(Z,Q)
    
    
    value(startdatetext,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.startdate(Z,D)
    
    date(startdate,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.startdate(Z,D)
    
    click(startdatetext) :: true(open(startdate),local)
    
    select(startdate,D) ::
      claim(C) &
      claim.hospitalization(C,Z)
      ==> hospitalization.startdate(Z,D)
    
    select(startdate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.startdate(Z,OD)
      ==> ~hospitalization.startdate(Z,OD)
    
    select(startdate,D) :: ~true(open(startdate),local) 
    
    style(startdate,"display","") :- true(open(startdate),local)
    style(startdate,"display","none") :- ~true(open(startdate),local)
    
    
    value(starttime,T) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.starttime(Z,T)
    
    select(starttime,T) ::
      claim(C) &
      claim.hospitalization(C,Z)
      ==> hospitalization.starttime(Z,T)
    
    select(starttime,T) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.starttime(Z,Q)
      ==> ~hospitalization.starttime(Z,Q)
    
    
    value(leavedatetext,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.enddate(Z,D)
    
    date(leavedate,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.enddate(Z,D)
    
    click(leavedatetext) :: true(open(leavedate),local)
    
    select(leavedate,D) ::
      claim(C) &
      claim.hospitalization(C,Z)
      ==> hospitalization.enddate(Z,D)
    
    select(leavedate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.enddate(Z,OD)
      ==> ~hospitalization.enddate(Z,OD)
    
    select(leavedate,Date) :: ~true(open(leavedate),local) 
    
    style(leavedate,"display","") :- true(open(leavedate),local)
    style(leavedate,"display","none") :- ~true(open(leavedate),local)
    
    
    value(leavetime,T) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.endtime(Z,T)
    
    select(leavetime,T) ::
      claim(C) &
      claim.hospitalization(C,Z)
      ==> hospitalization.endtime(Z,T)
    
    select(leavetime,T) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.endtime(Z,Q)
      ==> ~hospitalization.endtime(Z,Q)
    
    
    style(ineffectpopup,display,D) :-
      claim(C) &
      evaluate(if(plan_in_effect(C),none,true,block),D)
    
    style(partialdaypopup,display,D) :-
      claim(C) &
      evaluate(if(partial_day(C),block,true,none),D)
    
    style(max730popup,display,D) :-
      claim(C) &
      evaluate(if(over_730(C),block,true,none),D)
    
    
    %%% Physician Recommendation
    
    value(physicianref,X) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.physicianref(Z,X)
    
    select(physicianref,X) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      distinct(X,blank)
      ==> hospitalization.physicianref(Z,X)
    
    select(physicianref,X) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.physicianref(Z,Q)
      ==> ~hospitalization.physicianref(Z,Q)
    
    style(physicianrefpopup, display, D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      evaluate(if(hospitalization.physicianref(Z,no),block,true,none),D)
    
    
    value(claimtype,T) :- 
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      type(X,T)
    
    select(claimtype,blank) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> killaccident(X) & killillness(X)
    
    select(claimtype,accident) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> killillness(X) & type(X,accident)
    
    select(claimtype,illness) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> killaccident(X) & type(X,illness)
    
    killaccident(X) :: ~type(X,accident)
    killaccident(X) :: accident.subject(X,Y) ==> ~accident.subject(X,Y)
    killaccident(X) :: accident.activity(X,Y) ==> ~accident.activity(X,Y)
    killaccident(X) :: accident.country(X,Y) ==> ~accident.country(X,Y)
    killaccident(X) :: accident.date(X,Y) ==> ~accident.date(X,Y)
    
    killillness(X) :: ~type(X,illness)
    killillness(X) :: illness.date(X,Y) ==> ~illness.date(X,Y)
    killillness(X) :: illness.physician(X,Y) ==> ~illness.physician(X,Y)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Accidents, Events, and Illnesses
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    style(claimtype(accident),display,block) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      type(X,accident)
    
    style(claimtype(accident),display,none) :-
      ~style(claimtype(accident),display,block)
    
    
    value(accidentsubject,P) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.patient(Z,P)
    
    value(accidentsubject,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      countofall(P,hospitalization.patient(Z,P),0)
    
    
    value(accidentactivity,A) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.activity(X,A)
    
    value(accidentactivity,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      countofall(A,accident.activity(X,A),0)
    
    select(accidentactivity,A) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> accident.activity(X,A)
    
    select(accidentactivity,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.activity(X,Q)
      ==> ~accident.activity(X,Q)
    
    
    options(accidentcountry,L) :- setofall(X,type(X,country),L)
    
    value(accidentcountry,W) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.country(X,W)
    
    select(accidentcountry,A) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> accident.country(X,A)
    
    select(accidentcountry,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.country(X,Q)
      ==> ~accident.country(X,Q)
    
    
    value(accidentdatetext,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.date(X,D)
    
    value(accidentdatetext,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      countofall(D,accident.date(X,D),0)
    
    click(accidentdatetext) :: true(open(accidentdate),local)
    
    date(accidentdate,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.date(X,D)
    
    select(accidentdate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> accident.date(X,D)
    
    select(accidentdate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      accident.date(X,OD)
      ==> ~accident.date(X,OD)
    
    select(accidentdate,D) :: ~true(open(accidentdate),local) 
    
    style(accidentdate,"display","") :- true(open(accidentdate),local)
    style(accidentdate,"display","none") :- ~true(open(accidentdate),local)
    
    
    style(accidentpopup,display,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      evaluate(if(accident.activity(X,skydiving),block,true,none),D)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    style(claimtype(illness),display,block) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      type(X,illness)
    
    style(claimtype(illness),display,none) :-
      ~style(claimtype(illness),display,block)
    
    
    value(illnesssubject,P) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.patient(Z,P)
    
    value(illnesssubject,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      countofall(P,hospitalization.patient(Z,P),0)
    
    
    click(priordatetext) :: true(open(priordate),local)
    select(priordate,D) :: ~true(open(priordate),local) 
    style(priordate,"display","") :- true(open(priordate),local)
    style(priordate,"display","none") :- ~true(open(priordate),local)
    
    value(priordatetext,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      illness.date(X,D)
    
    value(priordatetext,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      countofall(D,illness.date(X,D),0)
    
    date(priordate,D) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      illness.date(X,D)
    
    select(priordate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> illness.date(X,D)
    
    select(priordate,D) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      illness.date(X,OD)
      ==> ~illness.date(Z,OD)
    
    
    value(consultation,P) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      illness.physician(X,P)
    
    value(consultation,blank) :-
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      countofall(P,illness.physician(X,P),0)
    
    select(consultation,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X)
      ==> illness.physician(X,P)
    
    select(consultation,P) ::
      claim(C) &
      claim.hospitalization(C,Z) &
      hospitalization.cause(Z,X) &
      illness.physician(X,Q)
      ==> ~illness.physician(X,Q)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%% Exclusions
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    value(feature(X),true) :- claim(C) & claim.exclusion(C,X)
    value(feature(X),false) :- claim(C) & feature(X) & ~claim.exclusion(C,X)
    select(feature(X),true) :: claim(C) ==> claim.exclusion(C,X)
    select(feature(X),false) :: claim(C) ==> ~claim.exclusion(C,X)
    
    style(exclusionpopup,display,D) :-
      claim(C) &
      evaluate(if(claim.exclusion(C,E),block,true,none),D)
    
    feature(preexist)
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    </textarea>
    
    <!--=======================================================================-->
    
    <textarea id='lambda' type="text/hrf" style="display:none">
    </textarea>
    
    <!--=======================================================================-->
    
    <dataset id='local' style='display:none'>
    </textarea>
    
    <!--=======================================================================-->
    
    
            </td>
          </tr>
        </table>
      </center>
    </body>
    
    <!--=======================================================================-->
    
    </html>
    